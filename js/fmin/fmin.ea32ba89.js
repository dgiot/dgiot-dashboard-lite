function r(r,f,i,e){var x=(e=e||{}).maxIterations||100,t=e.tolerance||1e-10,n=r(f),a=r(i),s=i-f;if(n*a>0)throw"Initial bisect points must have opposite signs";if(0===n)return f;if(0===a)return i;for(var o=0;o<x;++o){var u=f+(s/=2),c=r(u);if(c*n>=0&&(f=u),Math.abs(s)<t||0===c)return u}return f+s}function f(r){for(var f=new Array(r),i=0;i<r;++i)f[i]=0;return f}function i(r,i){return f(r).map((function(){return f(i)}))}function e(r,f){for(var i=0,e=0;e<r.length;++e)i+=r[e]*f[e];return i}function x(r){return Math.sqrt(e(r,r))}function t(r,f,i){for(var e=0;e<f.length;++e)r[e]=f[e]*i}function n(r,f,i,e,x){for(var t=0;t<r.length;++t)r[t]=f*i[t]+e*x[t]}function a(r,f,i){var e,x=(i=i||{}).maxIterations||200*f.length,t=i.nonZeroDelta||1.05,a=i.zeroDelta||.001,s=i.minErrorDelta||1e-6,o=i.minErrorDelta||1e-5,u=void 0!==i.rho?i.rho:1,c=void 0!==i.chi?i.chi:2,l=void 0!==i.psi?i.psi:-.5,p=void 0!==i.sigma?i.sigma:.5,m=f.length,h=new Array(m+1);h[0]=f,h[0].fx=r(f),h[0].id=0;for(var v=0;v<m;++v){var d=f.slice();d[v]=d[v]?d[v]*t:a,h[v+1]=d,h[v+1].fx=r(d),h[v+1].id=v+1}function g(r){for(var f=0;f<r.length;f++)h[m][f]=r[f];h[m].fx=r.fx}for(var b=function(r,f){return r.fx-f.fx},y=f.slice(),M=f.slice(),D=f.slice(),I=f.slice(),k=0;k<x;++k){if(h.sort(b),i.history){var w=h.map((function(r){var f=r.slice();return f.fx=r.fx,f.id=r.id,f}));w.sort((function(r,f){return r.id-f.id})),i.history.push({x:h[0].slice(),fx:h[0].fx,simplex:w})}for(e=0,v=0;v<m;++v)e=Math.max(e,Math.abs(h[0][v]-h[1][v]));if(Math.abs(h[0].fx-h[m].fx)<s&&e<o)break;for(v=0;v<m;++v){y[v]=0;for(var z=0;z<m;++z)y[v]+=h[z][v];y[v]/=m}var A=h[m];if(n(M,1+u,y,-u,A),M.fx=r(M),M.fx<h[0].fx)n(I,1+c,y,-c,A),I.fx=r(I),I.fx<M.fx?g(I):g(M);else if(M.fx>=h[m-1].fx){var E=!1;if(M.fx>A.fx?(n(D,1+l,y,-l,A),D.fx=r(D),D.fx<A.fx?g(D):E=!0):(n(D,1-l*u,y,l*u,A),D.fx=r(D),D.fx<M.fx?g(D):E=!0),E){if(p>=1)break;for(v=1;v<h.length;++v)n(h[v],1-p,h[0],p,h[v]),h[v].fx=r(h[v])}}else g(M)}return h.sort(b),{fx:h[0].fx,x:h[0]}}function s(r,f,i,x,t,a,s){var o=i.fx,u=e(i.fxprime,f),c=o,l=o,p=u,m=0;function h(l,m,h){for(var v=0;v<16;++v)if(t=(l+m)/2,n(x.x,1,i.x,t,f),c=x.fx=r(x.x,x.fxprime),p=e(x.fxprime,f),c>o+a*t*u||c>=h)m=t;else{if(Math.abs(p)<=-s*u)return t;p*(m-l)>=0&&(m=l),l=t,h=c}return 0}t=t||1,a=a||1e-6,s=s||.1;for(var v=0;v<10;++v){if(n(x.x,1,i.x,t,f),c=x.fx=r(x.x,x.fxprime),p=e(x.fxprime,f),c>o+a*t*u||v&&c>=l)return h(m,t,l);if(Math.abs(p)<=-s*u)return t;if(p>=0)return h(t,m,c);l=c,m=t,t*=2}return t}function o(r,f,i){var a,o,u,c={x:f.slice(),fx:0,fxprime:f.slice()},l={x:f.slice(),fx:0,fxprime:f.slice()},p=f.slice(),m=1;u=(i=i||{}).maxIterations||20*f.length,c.fx=r(c.x,c.fxprime),t(a=c.fxprime.slice(),c.fxprime,-1);for(var h=0;h<u;++h){if(m=s(r,a,c,l,m),i.history&&i.history.push({x:c.x.slice(),fx:c.fx,fxprime:c.fxprime.slice(),alpha:m}),m){n(p,1,l.fxprime,-1,c.fxprime);var v=e(c.fxprime,c.fxprime);n(a,Math.max(0,e(p,l.fxprime)/v),a,-1,l.fxprime),o=c,c=l,l=o}else t(a,c.fxprime,-1);if(x(c.fxprime)<=1e-5)break}return i.history&&i.history.push({x:c.x.slice(),fx:c.fx,fxprime:c.fxprime.slice(),alpha:m}),c}export{x as a,r as b,o as c,i as d,a as n,t as s,f as z};
