import{r as e}from"../react/react.e5edc743.js";import{_ as t,d as n}from"../@babel/@babel.7c7b387f.js";import{F as r,a as o,m as s,f as u,b as a,g as i}from"../focus-lock/focus-lock.749b4a34.js";import{c,a as d}from"../use-sidecar/use-sidecar.7fce5ba3.js";import{u as l}from"../use-callback-ref/use-callback-ref.208c8b26.js";import{w as f}from"../react-clientside-effect/react-clientside-effect.a7232328.js";var v={width:"1px",height:"0px",padding:0,overflow:"hidden",position:"fixed",top:"1px",left:"1px"},m=c({},(function(e){return{target:e.target,currentTarget:e.currentTarget}})),p=c(),b=c(),x=d({async:!0}),g=[],E=e.exports.forwardRef((function(n,s){var u,a=e.exports.useState(),i=a[0],c=a[1],d=e.exports.useRef(),f=e.exports.useRef(!1),b=e.exports.useRef(null),E=n.children,h=n.disabled,F=n.noFocusGuards,w=n.persistentFocus,k=n.crossFrame,y=n.autoFocus;n.allowTextSelection;var I=n.group,C=n.className,L=n.whiteList,T=n.hasPositiveIndices,j=n.shards,A=void 0===j?g:j,P=n.as,N=void 0===P?"div":P,O=n.lockProps,D=void 0===O?{}:O,M=n.sideCar,R=n.returnFocus,S=n.focusOptions,G=n.onActivation,B=n.onDeactivation,_=e.exports.useState({})[0],q=e.exports.useCallback((function(){b.current=b.current||document&&document.activeElement,d.current&&G&&G(d.current),f.current=!0}),[G]),z=e.exports.useCallback((function(){f.current=!1,B&&B(d.current)}),[B]);e.exports.useEffect((function(){h||(b.current=null)}),[]);var H=e.exports.useCallback((function(e){var t=b.current;if(t&&t.focus){var n="function"==typeof R?R(t):R;if(n){var r="object"==typeof n?n:void 0;b.current=null,e?Promise.resolve().then((function(){return t.focus(r)})):t.focus(r)}}}),[R]),J=e.exports.useCallback((function(e){f.current&&m.useMedium(e)}),[]),K=p.useMedium,Q=e.exports.useCallback((function(e){d.current!==e&&(d.current=e,c(e))}),[]),U=t(((u={})[r]=h&&"disabled",u[o]=I,u),D),V=!0!==F,W=V&&"tail"!==F,X=l([s,Q]);return e.exports.createElement(e.exports.Fragment,null,V&&[e.exports.createElement("div",{key:"guard-first","data-focus-guard":!0,tabIndex:h?-1:0,style:v}),T?e.exports.createElement("div",{key:"guard-nearest","data-focus-guard":!0,tabIndex:h?-1:1,style:v}):null],!h&&e.exports.createElement(M,{id:_,sideCar:x,observed:i,disabled:h,persistentFocus:w,crossFrame:k,autoFocus:y,whiteList:L,shards:A,onActivation:q,onDeactivation:z,returnFocus:H,focusOptions:S}),e.exports.createElement(N,t({ref:X},U,{className:C,onBlur:K,onFocus:J}),E),W&&e.exports.createElement("div",{"data-focus-guard":!0,tabIndex:h?-1:0,style:v}))}));E.propTypes={},E.defaultProps={children:void 0,disabled:!1,returnFocus:!1,focusOptions:void 0,noFocusGuards:!1,autoFocus:!0,persistentFocus:!1,crossFrame:!0,hasPositiveIndices:void 0,allowTextSelection:void 0,group:void 0,className:void 0,whiteList:void 0,shards:void 0,as:"div",lockProps:{},onActivation:void 0,onDeactivation:void 0};var h=E;function F(e){var t=window.setImmediate;void 0!==t?t(e):setTimeout(e,1)}var w=function(){return document&&document.activeElement===document.body||a()},k=null,y=null,I=null,C=!1,L=function(){return!0};function T(e,t,n,r){var o=null,s=e;do{var u=r[s];if(u.guard)u.node.dataset.focusAutoGuard&&(o=u);else{if(!u.lockItem)break;if(s!==e)return;o=null}}while((s+=n)!==t);o&&(o.node.tabIndex=0)}var j=function(e){return e&&"current"in e?e.current:e},A=function e(t,n,r){return n&&(n.host===t&&(!n.activeElement||r.contains(n.activeElement))||n.parentNode&&e(t,n.parentNode,r))},P=function(){var e,t=!1;if(k){var n=k,r=n.observed,o=n.persistentFocus,a=n.autoFocus,c=n.shards,d=n.crossFrame,l=n.focusOptions,f=r||I&&I.portaledElement,v=document&&document.activeElement;if(f){var m=[f].concat(c.map(j).filter(Boolean));if(v&&!function(e){return(k.whiteList||L)(e)}(v)||(o||(d?Boolean(C):"meanwhile"===C)||!w()||!y&&a)&&(f&&!(u(m)||v&&function(e,t){return t.some((function(t){return A(e,t,t)}))}(v,m)||(e=v,I&&I.portaledElement===e))&&(document&&!y&&v&&!a?(v.blur&&v.blur(),document.body.focus()):(t=s(m,y,{focusOptions:l}),I={})),C=!1,y=document&&document.activeElement),document){var p=document&&document.activeElement,b=i(m),x=b.map((function(e){return e.node})).indexOf(p);x>-1&&(b.filter((function(e){var t=e.guard,n=e.node;return t&&n.dataset.focusAutoGuard})).forEach((function(e){return e.node.removeAttribute("tabIndex")})),T(x,b.length,1,b),T(x,-1,-1,b))}}}return t},N=function(e){P()&&e&&(e.stopPropagation(),e.preventDefault())},O=function(){return F(P)},D=function(){C="just",setTimeout((function(){C="meanwhile"}),0)};m.assignSyncMedium((function(e){var t=e.target,n=e.currentTarget;n.contains(t)||(I={observerNode:n,portaledElement:t})})),p.assignMedium(O),b.assignMedium((function(e){return e({moveFocusInside:s,focusInside:u})}));var M=f((function(e){return e.filter((function(e){return!e.disabled}))}),(function(e){var t=e.slice(-1)[0];t&&!k&&(document.addEventListener("focusin",N),document.addEventListener("focusout",O),window.addEventListener("blur",D));var n=k,r=n&&t&&t.id===n.id;k=t,n&&!r&&(n.onDeactivation(),e.filter((function(e){return e.id===n.id})).length||n.returnFocus(!t)),t?(y=null,r&&n.observed===t.observed||t.onActivation(),P(),F(P)):(document.removeEventListener("focusin",N),document.removeEventListener("focusout",O),window.removeEventListener("blur",D),y=null)}))((function(){return null})),R=e.exports.forwardRef((function(n,r){return e.exports.createElement(h,t({sideCar:M,ref:r},n))})),S=h.propTypes||{};S.sideCar,n(S,["sideCar"]),R.propTypes={};var G=R;export{G as F};
