import{g as e}from"../@antv/@antv.821fe49b.js";import{r}from"../react/react.892b78e7.js";import{P as t}from"../prop-types/prop-types.e06977de.js";import{f as n}from"../file-selector/file-selector.1046aa15.js";import{_ as o}from"../attr-accept/attr-accept.fec1e0ad.js";import{j as i,F as a}from"../@arco-design/@arco-design.94e981f9.js";function c(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function u(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?c(Object(t),!0).forEach((function(r){l(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function l(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function s(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var n,o,i=[],a=!0,c=!1;try{for(t=t.call(e);!(a=(n=t.next()).done)&&(i.push(n.value),!r||i.length!==r);a=!0);}catch(u){c=!0,o=u}finally{try{a||null==t.return||t.return()}finally{if(c)throw o}}return i}(e,r)||function(e,r){if(!e)return;if("string"==typeof e)return f(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f(e,r)}(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var p={FileInvalidType:"file-invalid-type",FileTooLarge:"file-too-large",FileTooSmall:"file-too-small",TooManyFiles:"too-many-files"},g=function(e){e=Array.isArray(e)&&1===e.length?e[0]:e;var r=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:"file-invalid-type",message:"File type must be ".concat(r)}},d=function(e){return{code:"file-too-large",message:"File is larger than ".concat(e," ").concat(1===e?"byte":"bytes")}},y=function(e){return{code:"file-too-small",message:"File is smaller than ".concat(e," ").concat(1===e?"byte":"bytes")}},v={code:"too-many-files",message:"Too many files"};function b(e,r){var t="application/x-moz-file"===e.type||o(e,r);return[t,t?null:g(r)]}function m(e,r,t){if(D(e.size))if(D(r)&&D(t)){if(e.size>t)return[!1,d(t)];if(e.size<r)return[!1,y(r)]}else{if(D(r)&&e.size<r)return[!1,y(r)];if(D(t)&&e.size>t)return[!1,d(t)]}return[!0,null]}function D(e){return null!=e}function h(e){var r=e.files,t=e.accept,n=e.minSize,o=e.maxSize,i=e.multiple,a=e.maxFiles;return!(!i&&r.length>1||i&&a>=1&&r.length>a)&&r.every((function(e){var r=s(b(e,t),1)[0],i=s(m(e,n,o),1)[0];return r&&i}))}function O(e){return"function"==typeof e.isPropagationStopped?e.isPropagationStopped():void 0!==e.cancelBubble&&e.cancelBubble}function F(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,(function(e){return"Files"===e||"application/x-moz-file"===e})):!!e.target&&!!e.target.files}function j(e){e.preventDefault()}function w(e){return-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident/")}function x(e){return-1!==e.indexOf("Edge/")}function A(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.navigator.userAgent;return w(e)||x(e)}function S(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return r.some((function(r){return!O(e)&&r&&r.apply(void 0,[e].concat(n)),O(e)}))}}function E(){return"showOpenFilePicker"in window}function P(e){return e="string"==typeof e?e.split(","):e,[{description:"everything",accept:Array.isArray(e)?e.filter((function(e){return"audio/*"===e||"video/*"===e||"image/*"===e||"text/*"===e||/\w+\/[-+.\w]+/g.test(e)})).reduce((function(e,r){return u(u({},e),{},l({},r,[]))}),{}):{}}]}var C=["children"],k=["open"],z=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],T=["refKey","onChange","onClick"];function R(e){return function(e){if(Array.isArray(e))return K(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||L(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,r){return function(e){if(Array.isArray(e))return e}(e)||function(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==t)return;var n,o,i=[],a=!0,c=!1;try{for(t=t.call(e);!(a=(n=t.next()).done)&&(i.push(n.value),!r||i.length!==r);a=!0);}catch(u){c=!0,o=u}finally{try{a||null==t.return||t.return()}finally{if(c)throw o}}return i}(e,r)||L(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,r){if(e){if("string"==typeof e)return K(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?K(e,r):void 0}}function K(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function M(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function B(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?M(Object(t),!0).forEach((function(r){_(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function _(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function N(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var U=r.exports.forwardRef((function(e,t){var n=e.children,o=H(N(e,C)),c=o.open,u=N(o,k);return r.exports.useImperativeHandle(t,(function(){return{open:c}}),[c]),i(a,{children:n(B(B({},u),{},{open:c}))})}));U.displayName="Dropzone";var $={disabled:!1,getFilesFromEvent:n,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1};U.defaultProps=$,U.propTypes={children:t.func,accept:t.oneOfType([t.string,t.arrayOf(t.string)]),multiple:t.bool,preventDropOnDocument:t.bool,noClick:t.bool,noKeyboard:t.bool,noDrag:t.bool,noDragEventsBubbling:t.bool,minSize:t.number,maxSize:t.number,maxFiles:t.number,disabled:t.bool,getFilesFromEvent:t.func,onFileDialogCancel:t.func,onFileDialogOpen:t.func,useFsAccessApi:t.bool,onDragEnter:t.func,onDragLeave:t.func,onDragOver:t.func,onDrop:t.func,onDropAccepted:t.func,onDropRejected:t.func,validator:t.func};var q={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function H(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=B(B({},$),e),n=t.accept,o=t.disabled,i=t.getFilesFromEvent,a=t.maxSize,c=t.minSize,u=t.multiple,l=t.maxFiles,s=t.onDragEnter,f=t.onDragLeave,p=t.onDragOver,g=t.onDrop,d=t.onDropAccepted,y=t.onDropRejected,D=t.onFileDialogCancel,w=t.onFileDialogOpen,x=t.useFsAccessApi,C=t.preventDropOnDocument,k=t.noClick,L=t.noKeyboard,K=t.noDrag,M=t.noDragEventsBubbling,U=t.validator,H=r.exports.useMemo((function(){return"function"==typeof w?w:J}),[w]),Q=r.exports.useMemo((function(){return"function"==typeof D?D:J}),[D]),V=r.exports.useRef(null),W=r.exports.useRef(null),X=r.exports.useReducer(G,q),Y=I(X,2),Z=Y[0],ee=Y[1],re=Z.isFocused,te=Z.isFileDialogActive,ne=Z.draggedFiles,oe=function(){te&&setTimeout((function(){W.current&&(W.current.files.length||(ee({type:"closeDialog"}),Q()))}),300)};r.exports.useEffect((function(){return x&&E()?function(){}:(window.addEventListener("focus",oe,!1),function(){window.removeEventListener("focus",oe,!1)})}),[W,te,Q,x]);var ie=r.exports.useRef([]),ae=function(e){V.current&&V.current.contains(e.target)||(e.preventDefault(),ie.current=[])};r.exports.useEffect((function(){return C&&(document.addEventListener("dragover",j,!1),document.addEventListener("drop",ae,!1)),function(){C&&(document.removeEventListener("dragover",j),document.removeEventListener("drop",ae))}}),[V,C]);var ce=r.exports.useCallback((function(e){e.preventDefault(),e.persist(),he(e),ie.current=[].concat(R(ie.current),[e.target]),F(e)&&Promise.resolve(i(e)).then((function(r){O(e)&&!M||(ee({draggedFiles:r,isDragActive:!0,type:"setDraggedFiles"}),s&&s(e))}))}),[i,s,M]),ue=r.exports.useCallback((function(e){e.preventDefault(),e.persist(),he(e);var r=F(e);if(r&&e.dataTransfer)try{e.dataTransfer.dropEffect="copy"}catch(t){}return r&&p&&p(e),!1}),[p,M]),le=r.exports.useCallback((function(e){e.preventDefault(),e.persist(),he(e);var r=ie.current.filter((function(e){return V.current&&V.current.contains(e)})),t=r.indexOf(e.target);-1!==t&&r.splice(t,1),ie.current=r,r.length>0||(ee({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),F(e)&&f&&f(e))}),[V,f,M]),se=r.exports.useCallback((function(e,r){var t=[],o=[];e.forEach((function(e){var r=I(b(e,n),2),i=r[0],u=r[1],l=I(m(e,c,a),2),s=l[0],f=l[1],p=U?U(e):null;if(i&&s&&!p)t.push(e);else{var g=[u,f];p&&(g=g.concat(p)),o.push({file:e,errors:g.filter((function(e){return e}))})}})),(!u&&t.length>1||u&&l>=1&&t.length>l)&&(t.forEach((function(e){o.push({file:e,errors:[v]})})),t.splice(0)),ee({acceptedFiles:t,fileRejections:o,type:"setFiles"}),g&&g(t,o,r),o.length>0&&y&&y(o,r),t.length>0&&d&&d(t,r)}),[ee,u,n,c,a,l,g,d,y,U]),fe=r.exports.useCallback((function(e){e.preventDefault(),e.persist(),he(e),ie.current=[],F(e)&&Promise.resolve(i(e)).then((function(r){O(e)&&!M||se(r,e)})),ee({type:"reset"})}),[i,se,M]),pe=r.exports.useCallback((function(){if(x&&E()){ee({type:"openDialog"}),H();var e={multiple:u,types:P(n)};window.showOpenFilePicker(e).then((function(e){return i(e)})).then((function(e){return se(e,null)})).catch((function(e){return Q(e)})).finally((function(){return ee({type:"closeDialog"})}))}else W.current&&(ee({type:"openDialog"}),H(),W.current.value=null,W.current.click())}),[ee,H,Q,x,se,n,u]),ge=r.exports.useCallback((function(e){V.current&&V.current.isEqualNode(e.target)&&(32!==e.keyCode&&13!==e.keyCode||(e.preventDefault(),pe()))}),[V,W,pe]),de=r.exports.useCallback((function(){ee({type:"focus"})}),[]),ye=r.exports.useCallback((function(){ee({type:"blur"})}),[]),ve=r.exports.useCallback((function(){k||(A()?setTimeout(pe,0):pe())}),[W,k,pe]),be=function(e){return o?null:e},me=function(e){return L?null:be(e)},De=function(e){return K?null:be(e)},he=function(e){M&&e.stopPropagation()},Oe=r.exports.useMemo((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.refKey,t=void 0===r?"ref":r,n=e.role,i=e.onKeyDown,a=e.onFocus,c=e.onBlur,u=e.onClick,l=e.onDragEnter,s=e.onDragOver,f=e.onDragLeave,p=e.onDrop,g=N(e,z);return B(B(_({onKeyDown:me(S(i,ge)),onFocus:me(S(a,de)),onBlur:me(S(c,ye)),onClick:be(S(u,ve)),onDragEnter:De(S(l,ce)),onDragOver:De(S(s,ue)),onDragLeave:De(S(f,le)),onDrop:De(S(p,fe)),role:"string"==typeof n&&""!==n?n:"button"},t,V),o||L?{}:{tabIndex:0}),g)}}),[V,ge,de,ye,ve,ce,ue,le,fe,L,K,o]),Fe=r.exports.useCallback((function(e){e.stopPropagation()}),[]),je=r.exports.useMemo((function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.refKey,t=void 0===r?"ref":r,o=e.onChange,i=e.onClick,a=N(e,T),c=_({accept:n,multiple:u,type:"file",style:{display:"none"},onChange:be(S(o,fe)),onClick:be(S(i,Fe)),autoComplete:"off",tabIndex:-1},t,W);return B(B({},c),a)}}),[W,n,u,fe,o]),we=ne.length,xe=we>0&&h({files:ne,accept:n,minSize:c,maxSize:a,multiple:u,maxFiles:l}),Ae=we>0&&!xe;return B(B({},Z),{},{isDragAccept:xe,isDragReject:Ae,isFocused:re&&!o,getRootProps:Oe,getInputProps:je,rootRef:V,inputRef:W,open:be(pe)})}function G(e,r){switch(r.type){case"focus":return B(B({},e),{},{isFocused:!0});case"blur":return B(B({},e),{},{isFocused:!1});case"openDialog":return B(B({},q),{},{isFileDialogActive:!0});case"closeDialog":return B(B({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":var t=r.isDragActive,n=r.draggedFiles;return B(B({},e),{},{draggedFiles:n,isDragActive:t});case"setFiles":return B(B({},e),{},{acceptedFiles:r.acceptedFiles,fileRejections:r.fileRejections});case"reset":return B({},q);default:return e}}function J(){}var Q=e(Object.freeze(Object.defineProperty({__proto__:null,default:U,useDropzone:H,ErrorCode:p},Symbol.toStringTag,{value:"Module"})));export{Q as r};
