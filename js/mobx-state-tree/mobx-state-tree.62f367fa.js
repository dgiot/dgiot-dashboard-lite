import{g as t}from"../@antv/@antv.821fe49b.js";import{k as e,l as n,d as r,m as i,n as o,p as a,q as s,j as u,f as p,v as c,O as h,w as l,x as f,y as d,z as y,o as v,A as b,B as g,C as m}from"../mobx/mobx.55f70ff4.js";var w,_,P="warn";function S(t){P=t}function A(){return P}(_=w||(w={})).afterCreate="afterCreate",_.afterAttach="afterAttach",_.afterCreationFinalization="afterCreationFinalization",_.beforeDetach="beforeDetach",_.beforeDestroy="beforeDestroy";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var I=function(t,e){return(I=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function T(t,e){function n(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var C=function(){return C=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},C.apply(this,arguments)};function E(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a}function V(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function O(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function N(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function j(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(N(arguments[e]));return t}function D(t){return jt(t).type}function x(t,e){return jt(t).onPatch(e)}function k(t,e){jt(t).applyPatches(Jt(e))}function R(t,e){return jt(t).applySnapshot(e)}function z(t,e){void 0===e&&(e=!0);var n=jt(t);return e?n.snapshot:n.type.getSnapshot(n,!1)}function F(t){return jt(t).root.storedValue}function M(t){return jt(t).path}function H(t){return jt(t).identifier}function L(t,e){var n=zt(jt(t),e,!1);if(void 0!==n)try{return n.value}catch(r){return}}function U(t){return jt(t).observableIsAlive}function $(t){var e;return{name:(e=Nt(t)?D(t):t).name,properties:C({},e.properties)}}var W,G,Y=function(){function t(t,e,n,r){this.type=t,this.environment=r,this._state=It.INITIALIZING,this.environment=r,this.baseSetParent(e,n)}return Object.defineProperty(t.prototype,"subpath",{get:function(){return this._subpath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"subpathUponDeath",{get:function(){return this._subpathUponDeath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pathUponDeath",{get:function(){return this._pathUponDeath},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.type.getValue(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(t){var e=this.isAlive;this._state=t;var n=this.isAlive;this.aliveAtom&&e!==n&&this.aliveAtom.reportChanged()},enumerable:!1,configurable:!0}),t.prototype.fireInternalHook=function(t){this._hookSubscribers&&this._hookSubscribers.emit(t,this,t)},t.prototype.registerHook=function(t,e){return this._hookSubscribers||(this._hookSubscribers=new Xt),this._hookSubscribers.register(t,e)},Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),t.prototype.baseSetParent=function(t,e){this._parent=t,this._subpath=e,this._escapedSubpath=void 0,this.pathAtom&&this.pathAtom.reportChanged()},Object.defineProperty(t.prototype,"path",{get:function(){return this.getEscapedPath(!0)},enumerable:!1,configurable:!0}),t.prototype.getEscapedPath=function(t){return t&&(this.pathAtom||(this.pathAtom=r("path")),this.pathAtom.reportObserved()),this.parent?(void 0===this._escapedSubpath&&(this._escapedSubpath=this._subpath?se(this._subpath):""),this.parent.getEscapedPath(t)+"/"+this._escapedSubpath):""},Object.defineProperty(t.prototype,"isRoot",{get:function(){return null===this.parent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isAlive",{get:function(){return this.state!==It.DEAD},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isDetaching",{get:function(){return this.state===It.DETACHING},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"observableIsAlive",{get:function(){return this.aliveAtom||(this.aliveAtom=r("alive")),this.aliveAtom.reportObserved(),this.isAlive},enumerable:!1,configurable:!0}),t.prototype.baseFinalizeCreation=function(t){if(this.state===It.CREATED){if(this.parent){if(this.parent.state!==It.FINALIZED)return;this.fireHook(w.afterAttach)}this.state=It.FINALIZED,t&&t()}},t.prototype.baseFinalizeDeath=function(){this._hookSubscribers&&this._hookSubscribers.clearAll(),this._subpathUponDeath=this._subpath,this._pathUponDeath=this.getEscapedPath(!1),this.baseSetParent(null,""),this.state=It.DEAD},t.prototype.baseAboutToDie=function(){this.fireHook(w.beforeDestroy)},t}(),J=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n,r,i)||this;try{a.storedValue=e.createNewInstance(o)}catch(s){throw a.state=It.DEAD,s}return a.state=It.CREATED,a.finalizeCreation(),a}return T(e,t),Object.defineProperty(e.prototype,"root",{get:function(){if(!this.parent)throw $t("This scalar node is not part of a tree");return this.parent.root},enumerable:!1,configurable:!0}),e.prototype.setParent=function(t,e){var n=this.parent!==t,r=this.subpath!==e;(n||r)&&(this.environment=void 0,this.baseSetParent(this.parent,e))},Object.defineProperty(e.prototype,"snapshot",{get:function(){return this.getSnapshot()},enumerable:!1,configurable:!0}),e.prototype.getSnapshot=function(){return this.type.getSnapshot(this)},e.prototype.toString=function(){var t=(this.isAlive?this.path:this.pathUponDeath)||"<root>";return this.type.name+"@"+t+(this.isAlive?"":" [dead]")},e.prototype.die=function(){this.isAlive&&this.state!==It.DETACHING&&(this.aboutToDie(),this.finalizeDeath())},e.prototype.finalizeCreation=function(){this.baseFinalizeCreation()},e.prototype.aboutToDie=function(){this.baseAboutToDie()},e.prototype.finalizeDeath=function(){this.baseFinalizeDeath()},e.prototype.fireHook=function(t){this.fireInternalHook(t)},E([a],e.prototype,"die",null),e}(Y),Z=1,B={onError:function(t){throw t}},K=function(t){function e(e,n,r,i,o){var a=t.call(this,e,n,r,i)||this;if(a.nodeId=++Z,a.isProtectionEnabled=!0,a._autoUnbox=!0,a._isRunningAction=!1,a._hasSnapshotReaction=!1,a._observableInstanceState=0,a._cachedInitialSnapshotCreated=!1,a.unbox=a.unbox.bind(a),a._initialSnapshot=o,a.identifierAttribute=e.identifierAttribute,n||(a.identifierCache=new Et),a._childNodes=e.initializeChildNodes(a,a._initialSnapshot),a.identifier=null,a.unnormalizedIdentifier=null,a.identifierAttribute&&a._initialSnapshot){var s=a._initialSnapshot[a.identifierAttribute];if(void 0===s){var u=a._childNodes[a.identifierAttribute];u&&(s=u.value)}if("string"!=typeof s&&"number"!=typeof s)throw $t("Instance identifier '"+a.identifierAttribute+"' for type '"+a.type.name+"' must be a string or a number");a.identifier=pn(s),a.unnormalizedIdentifier=s}return n?n.root.identifierCache.addNodeToCache(a):a.identifierCache.addNodeToCache(a),a}return T(e,t),e.prototype.applyPatches=function(t){this.createObservableInstanceIfNeeded(),this._applyPatches(t)},e.prototype.applySnapshot=function(t){this.createObservableInstanceIfNeeded(),this._applySnapshot(t)},e.prototype.createObservableInstanceIfNeeded=function(){0===this._observableInstanceState&&this.createObservableInstance()},e.prototype.createObservableInstance=function(){var t,e;this._observableInstanceState=1;for(var n=[],r=this.parent;r&&0===r._observableInstanceState;)n.unshift(r),r=r.parent;try{for(var i=O(n),o=i.next();!o.done;o=i.next()){o.value.createObservableInstanceIfNeeded()}}catch(s){t={error:s}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}var a=this.type;try{this.storedValue=a.createNewInstance(this._childNodes),this.preboot(),this._isRunningAction=!0,a.finalizeNewInstance(this,this.storedValue)}catch(u){throw this.state=It.DEAD,u}finally{this._isRunningAction=!1}this._observableInstanceState=2,c(this,"snapshot").trackAndCompute(),this.isRoot&&this._addSnapshotReaction(),this._childNodes=Lt,this.state=It.CREATED,this.fireHook(w.afterCreate),this.finalizeCreation()},Object.defineProperty(e.prototype,"root",{get:function(){var t=this.parent;return t?t.root:this},enumerable:!1,configurable:!0}),e.prototype.clearParent=function(){if(this.parent){this.fireHook(w.beforeDetach);var t=this.state;this.state=It.DETACHING;var e=this.root,n=e.environment,r=e.identifierCache.splitCache(this);try{this.parent.removeChild(this.subpath),this.baseSetParent(null,""),this.environment=n,this.identifierCache=r}finally{this.state=t}}},e.prototype.setParent=function(t,e){var n=t!==this.parent,r=e!==this.subpath;(n||r)&&(n?(this.environment=void 0,t.root.identifierCache.mergeCache(this),this.baseSetParent(t,e),this.fireHook(w.afterAttach)):r&&this.baseSetParent(this.parent,e))},e.prototype.fireHook=function(t){var e=this;this.fireInternalHook(t);var n=this.storedValue&&"object"==typeof this.storedValue&&this.storedValue[t];"function"==typeof n&&(i?i((function(){n.apply(e.storedValue)})):n.apply(this.storedValue))},Object.defineProperty(e.prototype,"snapshot",{get:function(){return this.getSnapshot()},enumerable:!1,configurable:!0}),e.prototype.getSnapshot=function(){return this.isAlive?2===this._observableInstanceState?this._getActualSnapshot():this._getCachedInitialSnapshot():this._snapshotUponDeath},e.prototype._getActualSnapshot=function(){return this.type.getSnapshot(this)},e.prototype._getCachedInitialSnapshot=function(){if(!this._cachedInitialSnapshotCreated){var t=this.type,e=this._childNodes,n=this._initialSnapshot;this._cachedInitialSnapshot=t.processInitialSnapshot(e,n),this._cachedInitialSnapshotCreated=!0}return this._cachedInitialSnapshot},e.prototype.isRunningAction=function(){return!!this._isRunningAction||!this.isRoot&&this.parent.isRunningAction()},e.prototype.assertAlive=function(t){var e=A();if(!this.isAlive&&"ignore"!==e){var n=this._getAssertAliveError(t);if("error"===e)throw $t(n)}},e.prototype._getAssertAliveError=function(t){var e=this.getEscapedPath(!1)||this.pathUponDeath||"",n=t.subpath&&se(t.subpath)||"",r=t.actionContext||ut();r&&"action"!==r.type&&r.parentActionEvent&&(r=r.parentActionEvent);var i="";r&&null!=r.name&&(i=(r&&r.context&&M(r.context)||e)+"."+r.name+"()");return"You are trying to read or write to an object that is no longer part of a state tree. (Object type: '"+this.type.name+"', Path upon death: '"+e+"', Subpath: '"+n+"', Action: '"+i+"'). Either detach nodes first, or don't use objects after removing / replacing them in the tree."},e.prototype.getChildNode=function(t){this.assertAlive({subpath:t}),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildNode(this,t):this._childNodes[t]}finally{this._autoUnbox=!0}},e.prototype.getChildren=function(){this.assertAlive(Lt),this._autoUnbox=!1;try{return 2===this._observableInstanceState?this.type.getChildren(this):Mt(this._childNodes)}finally{this._autoUnbox=!0}},e.prototype.getChildType=function(t){return this.type.getChildType(t)},Object.defineProperty(e.prototype,"isProtected",{get:function(){return this.root.isProtectionEnabled},enumerable:!1,configurable:!0}),e.prototype.assertWritable=function(t){if(this.assertAlive(t),!this.isRunningAction()&&this.isProtected)throw $t("Cannot modify '"+this+"', the object is protected and can only be modified by using an action.")},e.prototype.removeChild=function(t){this.type.removeChild(this,t)},e.prototype.unbox=function(t){return t?(this.assertAlive({subpath:t.subpath||t.subpathUponDeath}),this._autoUnbox?t.value:t):t},e.prototype.toString=function(){var t=(this.isAlive?this.path:this.pathUponDeath)||"<root>",e=this.identifier?"(id: "+this.identifier+")":"";return this.type.name+"@"+t+e+(this.isAlive?"":" [dead]")},e.prototype.finalizeCreation=function(){var t=this;this.baseFinalizeCreation((function(){var e,n;try{for(var r=O(t.getChildren()),i=r.next();!i.done;i=r.next()){i.value.finalizeCreation()}}catch(o){e={error:o}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}t.fireInternalHook(w.afterCreationFinalization)}))},e.prototype.detach=function(){if(!this.isAlive)throw $t("Error while detaching, node is not alive.");this.clearParent()},e.prototype.preboot=function(){var t=this;this._applyPatches=lt(this.storedValue,"@APPLY_PATCHES",(function(e){e.forEach((function(e){var n=ce(e.path);Ft(t,n.slice(0,-1)).applyPatchLocally(n[n.length-1],e)}))})),this._applySnapshot=lt(this.storedValue,"@APPLY_SNAPSHOT",(function(e){if(e!==t.snapshot)return t.type.applySnapshot(t,e)})),qt(this.storedValue,"$treenode",this),qt(this.storedValue,"toJSON",xt)},e.prototype.die=function(){this.isAlive&&this.state!==It.DETACHING&&(this.aboutToDie(),this.finalizeDeath())},e.prototype.aboutToDie=function(){0!==this._observableInstanceState&&(this.getChildren().forEach((function(t){t.aboutToDie()})),this.baseAboutToDie(),this._internalEventsEmit("dispose"),this._internalEventsClear("dispose"))},e.prototype.finalizeDeath=function(){this.getChildren().forEach((function(t){t.finalizeDeath()})),this.root.identifierCache.notifyDied(this);var t=this.snapshot;this._snapshotUponDeath=t,this._internalEventsClearAll(),this.baseFinalizeDeath()},e.prototype.onSnapshot=function(t){return this._addSnapshotReaction(),this._internalEventsRegister("snapshot",t)},e.prototype.emitSnapshot=function(t){this._internalEventsEmit("snapshot",t)},e.prototype.onPatch=function(t){return this._internalEventsRegister("patch",t)},e.prototype.emitPatch=function(t,e){if(this._internalEventsHasSubscribers("patch")){var n=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0;r<e.length;r++){var i=e[r];for(var o in i)t[o]=i[o]}return t}({},t,{path:e.path.substr(this.path.length)+"/"+t.path}),r=N(function(t){if(!("oldValue"in t))throw $t("Patches without `oldValue` field cannot be inversed");return[oe(t),ae(t)]}(n),2),i=r[0],o=r[1];this._internalEventsEmit("patch",i,o)}this.parent&&this.parent.emitPatch(t,e)},e.prototype.hasDisposer=function(t){return this._internalEventsHas("dispose",t)},e.prototype.addDisposer=function(t){if(this.hasDisposer(t))throw $t("cannot add a disposer when it is already registered for execution");this._internalEventsRegister("dispose",t,!0)},e.prototype.removeDisposer=function(t){if(!this._internalEventsHas("dispose",t))throw $t("cannot remove a disposer which was never registered for execution");this._internalEventsUnregister("dispose",t)},e.prototype.removeMiddleware=function(t){if(this.middlewares){var e=this.middlewares.indexOf(t);e>=0&&this.middlewares.splice(e,1)}},e.prototype.addMiddleWare=function(t,e){var n=this;void 0===e&&(e=!0);var r={handler:t,includeHooks:e};return this.middlewares?this.middlewares.push(r):this.middlewares=[r],function(){n.removeMiddleware(r)}},e.prototype.applyPatchLocally=function(t,e){this.assertWritable({subpath:t}),this.createObservableInstanceIfNeeded(),this.type.applyPatchLocally(this,t,e)},e.prototype._addSnapshotReaction=function(){var t=this;if(!this._hasSnapshotReaction){var e=o((function(){return t.snapshot}),(function(e){return t.emitSnapshot(e)}),B);this.addDisposer(e),this._hasSnapshotReaction=!0}},e.prototype._internalEventsHasSubscribers=function(t){return!!this._internalEvents&&this._internalEvents.hasSubscribers(t)},e.prototype._internalEventsRegister=function(t,e,n){return void 0===n&&(n=!1),this._internalEvents||(this._internalEvents=new Xt),this._internalEvents.register(t,e,n)},e.prototype._internalEventsHas=function(t,e){return!!this._internalEvents&&this._internalEvents.has(t,e)},e.prototype._internalEventsUnregister=function(t,e){this._internalEvents&&this._internalEvents.unregister(t,e)},e.prototype._internalEventsEmit=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];this._internalEvents&&(e=this._internalEvents).emit.apply(e,j([t],n))},e.prototype._internalEventsClear=function(t){this._internalEvents&&this._internalEvents.clear(t)},e.prototype._internalEventsClearAll=function(){this._internalEvents&&this._internalEvents.clearAll()},E([a],e.prototype,"createObservableInstance",null),E([s],e.prototype,"snapshot",null),E([a],e.prototype,"detach",null),E([a],e.prototype,"die",null),e}(Y);(G=W||(W={}))[G.String=1]="String",G[G.Number=2]="Number",G[G.Boolean=4]="Boolean",G[G.Date=8]="Date",G[G.Literal=16]="Literal",G[G.Array=32]="Array",G[G.Map=64]="Map",G[G.Object=128]="Object",G[G.Frozen=256]="Frozen",G[G.Optional=512]="Optional",G[G.Reference=1024]="Reference",G[G.Identifier=2048]="Identifier",G[G.Late=4096]="Late",G[G.Refinement=8192]="Refinement",G[G.Union=16384]="Union",G[G.Null=32768]="Null",G[G.Undefined=65536]="Undefined",G[G.Integer=131072]="Integer",G[G.Custom=262144]="Custom",G[G.SnapshotProcessor=524288]="SnapshotProcessor";var q=function(){function t(t){this.isType=!0,this.name=t}return t.prototype.create=function(t,e){return St(this,t),this.instantiate(null,"",e,t).value},t.prototype.getSnapshot=function(t,e){throw $t("unimplemented method")},t.prototype.isAssignableFrom=function(t){return t===this},t.prototype.validate=function(t,e){if(Dt(t)){var n=D(t);return this.isAssignableFrom(n)?wt():_t(e,t)}return this.isValidSnapshot(t,e)},t.prototype.is=function(t){return 0===this.validate(t,[{path:"",type:this}]).length},Object.defineProperty(t.prototype,"Type",{get:function(){throw $t("Factory.Type should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.Type`")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TypeWithoutSTN",{get:function(){throw $t("Factory.TypeWithoutSTN should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.TypeWithoutSTN`")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"SnapshotType",{get:function(){throw $t("Factory.SnapshotType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.SnapshotType`")},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"CreationType",{get:function(){throw $t("Factory.CreationType should not be actually called. It is just a Type signature that can be used at compile time with Typescript, by using `typeof type.CreationType`")},enumerable:!1,configurable:!0}),E([a],t.prototype,"create",null),t}(),Q=function(t){function e(e){return t.call(this,e)||this}return T(e,t),e.prototype.create=function(e,n){return void 0===e&&(e=this.getDefaultSnapshot()),t.prototype.create.call(this,e,n)},e.prototype.getValue=function(t){return t.createObservableInstanceIfNeeded(),t.storedValue},e.prototype.tryToReconcileNode=function(t,e){return!t.isDetaching&&(t.snapshot===e||(!(!Nt(e)||jt(e)!==t)||!(t.type!==this||!Bt(e)||Nt(e)||t.identifierAttribute&&t.identifier!==pn(e[t.identifierAttribute]))&&(t.applySnapshot(e),!0)))},e.prototype.reconcile=function(t,e,n,r){if(this.tryToReconcileNode(t,e))return t.setParent(n,r),t;if(t.die(),Nt(e)&&this.isAssignableFrom(D(e))){var i=jt(e);return i.setParent(n,r),i}return this.instantiate(n,r,void 0,e)},e.prototype.getSubTypes=function(){return null},E([a],e.prototype,"create",null),e}(q),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return T(e,t),e.prototype.createNewInstance=function(t){return t},e.prototype.getValue=function(t){return t.storedValue},e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.reconcile=function(t,e,n,r){if(!t.isDetaching&&t.type===this&&t.storedValue===e)return t;var i=this.instantiate(n,r,void 0,e);return t.die(),i},e.prototype.getSubTypes=function(){return null},e}(q);function tt(t){return"object"==typeof t&&t&&!0===t.isType}var et=new Map;var nt=function(){function t(t,e){this.hooks=t,this.call=e,this.flowsPending=0,this.running=!0,t&&t.onStart(e)}return t.prototype.finish=function(t){this.running&&(this.running=!1,this.hooks&&this.hooks.onFinish(this.call,t))},t.prototype.incFlowsPending=function(){this.flowsPending++},t.prototype.decFlowsPending=function(){this.flowsPending--},Object.defineProperty(t.prototype,"hasFlowsPending",{get:function(){return this.flowsPending>0},enumerable:!1,configurable:!0}),t}();function rt(t){return{$MST_UNSERIALIZABLE:!0,type:t}}function it(t,e){u((function(){Jt(e).forEach((function(e){return function(t,e){var n=L(t,e.path||"");if(!n)throw $t("Invalid action path: "+(e.path||""));var r=jt(n);if("@APPLY_PATCHES"===e.name)return k.call(null,n,e.args[0]);if("@APPLY_SNAPSHOT"===e.name)return R.call(null,n,e.args[0]);if("function"!=typeof n[e.name])throw $t("Action '"+e.name+"' does not exist in '"+r.path+"'");return n[e.name].apply(n,e.args?e.args.map((function(t){return(e=t)&&"object"==typeof e&&"$MST_DATE"in e?new Date(e.$MST_DATE):e;var e})):[])}(t,e)}))}))}function ot(t,e,n){return void 0===n&&(n=!1),ft(t,(function(r,i){if("action"===r.type&&r.id===r.rootId){var o=jt(r.context),a={name:r.name,path:Rt(jt(t),o),args:r.args.map((function(t,e){return function(t,e,n,r){if(r instanceof Date)return{$MST_DATE:r.getTime()};if(Kt(r))return r;if(Nt(r))return rt("[MSTNode: "+D(r).name+"]");if("function"==typeof r)return rt("[function]");if("object"==typeof r&&!Zt(r)&&!Yt(r))return rt("[object "+(r&&r.constructor&&r.constructor.name||"Complex Object")+"]");try{return JSON.stringify(r),r}catch(i){return rt(""+i)}}(0,r.name,0,t)}))};if(n){var s=i(r);return e(a),s}return e(a),i(r)}return i(r)}))}var at,st=1;function ut(){return at}function pt(){return st++}function ct(t,e){var n=jt(t.context);"action"===t.type&&n.assertAlive({actionContext:t});var r=n._isRunningAction;n._isRunningAction=!0;var i=at;at=t;try{return function(t,e,n){var r=new dt(t,n);if(r.isEmpty)return a(n).apply(null,e.args);var i=null;function o(t){var e=r.getNextMiddleware(),s=e&&e.handler;if(!s)return a(n).apply(null,t.args);if(!e.includeHooks&&w[t.name])return o(t);function u(t,e){i=o(t),e&&(i=e(i))}function p(t){i=t}return s(t,u,p),i}return o(e)}(n,t,e)}finally{at=i,n._isRunningAction=r}}function ht(t){if(t)return"action"===t.type?t:t.parentActionEvent}function lt(t,e,n){var r=function(){var r=pt(),i=at,o=ht(i);return ct({type:"action",name:e,id:r,args:te(arguments),context:t,tree:F(t),rootId:i?i.rootId:r,parentId:i?i.id:0,allParentIds:i?j(i.allParentIds,[i.id]):[],parentEvent:i,parentActionEvent:o},n)};return r._isMSTAction=!0,r}function ft(t,e,n){return void 0===n&&(n=!0),jt(t).addMiddleWare(e,n)}var dt=function(){function t(t,e){this.arrayIndex=0,this.inArrayIndex=0,this.middlewares=[],e.$mst_middleware&&this.middlewares.push(e.$mst_middleware);for(var n=t;n;)n.middlewares&&this.middlewares.push(n.middlewares),n=n.parent}return Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.middlewares.length<=0},enumerable:!1,configurable:!0}),t.prototype.getNextMiddleware=function(){var t=this.middlewares[this.arrayIndex];if(t){var e=t[this.inArrayIndex++];return e||(this.arrayIndex++,this.inArrayIndex=0,this.getNextMiddleware())}},t}();function yt(){for(var t=ut();t&&"action"!==t.type;)t=t.parentActionEvent;return t}function vt(t,e,n){for(var r="number"==typeof e?e:e.id,i=n?t:t.parentActionEvent;i;){if(i.id===r)return!0;i=i.parentActionEvent}return!1}function bt(t){return"function"==typeof t?"<function"+(t.name?" "+t.name:"")+">":Nt(t)?"<"+t+">":"`"+function(t){try{return JSON.stringify(t)}catch(e){return"<Unserializable: "+e+">"}}(t)+"`"}function gt(t){var e=t.value,n=t.context[t.context.length-1].type,r=t.context.map((function(t){return t.path})).filter((function(t){return t.length>0})).join("/"),i=r.length>0?'at path "/'+r+'" ':"",o=Nt(e)?"value of type "+jt(e).type.name+":":Kt(e)?"value":"snapshot",a=n&&Nt(e)&&n.is(jt(e).snapshot);return""+i+o+" "+bt(e)+" is not assignable "+(n?"to type: `"+n.name+"`":"")+(t.message?" ("+t.message+")":"")+(n?Re(n)||Kt(e)?".":", expected an instance of `"+n.name+"` or a snapshot like `"+n.describe()+"` instead."+(a?" (Note that a snapshot of the provided value is compatible with the targeted type)":""):".")}function mt(t,e,n){return t.concat([{path:e,type:n}])}function wt(){return Ht}function _t(t,e,n){return[{context:t,value:e,message:n}]}function Pt(t){return t.reduce((function(t,e){return t.concat(e)}),[])}function St(t,e){"undefined"!=typeof process&&process.env&&"true"==={}.ENABLE_TYPE_CHECK&&At(t,e)}function At(t,e){var n=t.validate(e,[{path:"",type:t}]);if(n.length>0)throw $t(function(t,e,n){if(0===n.length)return;return"Error while converting "+(r=bt(e),(r.length<280?r:r.substring(0,272)+"......"+r.substring(r.length-8))+" to `")+t.name+"`:\n\n    "+n.map(gt).join("\n    ");var r}(t,e,n))}var It,Tt,Ct=0,Et=function(){function t(){this.cacheId=Ct++,this.cache=v.map(),this.lastCacheModificationPerId=v.map()}return t.prototype.updateLastCacheModificationPerId=function(t){var e=this.lastCacheModificationPerId.get(t);this.lastCacheModificationPerId.set(t,void 0===e?1:e+1)},t.prototype.getLastCacheModificationPerId=function(t){var e=this.lastCacheModificationPerId.get(t)||0;return this.cacheId+"-"+e},t.prototype.addNodeToCache=function(t,e){if(void 0===e&&(e=!0),t.identifierAttribute){var n=t.identifier;this.cache.has(n)||this.cache.set(n,v.array([],Ut));var r=this.cache.get(n);if(-1!==r.indexOf(t))throw $t("Already registered");r.push(t),e&&this.updateLastCacheModificationPerId(n)}},t.prototype.mergeCache=function(t){var e=this;y(t.identifierCache.cache).forEach((function(t){return t.forEach((function(t){e.addNodeToCache(t)}))}))},t.prototype.notifyDied=function(t){if(t.identifierAttribute){var e=t.identifier,n=this.cache.get(e);n&&(n.remove(t),n.length||this.cache.delete(e),this.updateLastCacheModificationPerId(t.identifier))}},t.prototype.splitCache=function(e){var n=this,r=new t,i=e.path;return m(this.cache).forEach((function(t){for(var e=N(t,2),o=e[0],a=e[1],s=!1,u=a.length-1;u>=0;u--)0===a[u].path.indexOf(i)&&(r.addNodeToCache(a[u],!1),a.splice(u,1),s=!0);s&&n.updateLastCacheModificationPerId(o)})),r},t.prototype.has=function(t,e){var n=this.cache.get(e);return!!n&&n.some((function(e){return t.isAssignableFrom(e.type)}))},t.prototype.resolve=function(t,e){var n=this.cache.get(e);if(!n)return null;var r=n.filter((function(e){return t.isAssignableFrom(e.type)}));switch(r.length){case 0:return null;case 1:return r[0];default:throw $t("Cannot resolve a reference to type '"+t.name+"' with id: '"+e+"' unambigously, there are multiple candidates: "+r.map((function(t){return t.path})).join(", "))}},t}();function Vt(t,e,n,r,i){var o=Dt(i);if(o){if(o.parent)throw $t("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+(e?e.path:"")+"/"+n+"', but it lives already at '"+o.path+"'");return e&&o.setParent(e,n),o}return new K(t,e,n,r,i)}function Ot(t,e,n,r,i){return new J(t,e,n,r,i)}function Nt(t){return!(!t||!t.$treenode)}function jt(t){if(!Nt(t))throw $t("Value "+t+" is no MST Node");return t.$treenode}function Dt(t){return t&&t.$treenode||null}function xt(){return jt(this).snapshot}(Tt=It||(It={}))[Tt.INITIALIZING=0]="INITIALIZING",Tt[Tt.CREATED=1]="CREATED",Tt[Tt.FINALIZED=2]="FINALIZED",Tt[Tt.DETACHING=3]="DETACHING",Tt[Tt.DEAD=4]="DEAD";var kt=function(t){return".."};function Rt(t,e){if(t.root!==e.root)throw $t("Cannot calculate relative path: objects '"+t+"' and '"+e+"' are not part of the same object tree");for(var n=ce(t.path),r=ce(e.path),i=0;i<n.length&&n[i]===r[i];i++);return n.slice(i).map(kt).join("/")+pe(r.slice(i))}function zt(t,e,n){return void 0===n&&(n=!0),Ft(t,ce(e),n)}function Ft(t,e,n){void 0===n&&(n=!0);for(var r=t,i=0;i<e.length;i++){var o=e[i];if(".."===o){if(r=r.parent)continue}else{if("."===o)continue;if(r){if(r instanceof J)try{var a=r.value;Nt(a)&&(r=jt(a))}catch(s){if(!n)return;throw s}if(r instanceof K)if(r.getChildType(o)&&(r=r.getChildNode(o)))continue}}if(n)throw $t("Could not resolve '"+o+"' in path '"+(pe(e.slice(0,i))||"/")+"' while resolving '"+pe(e)+"'");return}return r}function Mt(t){if(!t)return Ht;var e=Object.keys(t);if(!e.length)return Ht;var n=new Array(e.length);return e.forEach((function(e,r){n[r]=t[e]})),n}var Ht=Object.freeze([]),Lt=Object.freeze({}),Ut={deep:!1};function $t(t){return void 0===t&&(t="Illegal state"),new Error("[mobx-state-tree] "+t)}function Wt(t){return t}Object.freeze(Ut);var Gt=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function Yt(t){return Array.isArray(t)||p(t)}function Jt(t){return t?Yt(t)?t:[t]:Ht}function Zt(t){if(null===t||"object"!=typeof t)return!1;var e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}function Bt(t){return!(null===t||"object"!=typeof t||t instanceof Date||t instanceof RegExp)}function Kt(t,e){return void 0===e&&(e=!0),null==t||!!("string"==typeof t||"number"==typeof t||"boolean"==typeof t||e&&t instanceof Date)}function qt(t,e,n){Object.defineProperty(t,e,{enumerable:!1,writable:!1,configurable:!0,value:n})}var Qt=function(){function t(){this.handlers=[]}return Object.defineProperty(t.prototype,"hasSubscribers",{get:function(){return this.handlers.length>0},enumerable:!1,configurable:!0}),t.prototype.register=function(t,e){var n=this;return void 0===e&&(e=!1),e?this.handlers.unshift(t):this.handlers.push(t),function(){n.unregister(t)}},t.prototype.has=function(t){return this.handlers.indexOf(t)>=0},t.prototype.unregister=function(t){var e=this.handlers.indexOf(t);e>=0&&this.handlers.splice(e,1)},t.prototype.clear=function(){this.handlers.length=0},t.prototype.emit=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.handlers.slice();n.forEach((function(e){return e.apply(void 0,j(t))}))},t}(),Xt=function(){function t(){}return t.prototype.hasSubscribers=function(t){var e=this.eventHandlers&&this.eventHandlers[t];return!!e&&e.hasSubscribers},t.prototype.register=function(t,e,n){void 0===n&&(n=!1),this.eventHandlers||(this.eventHandlers={});var r=this.eventHandlers[t];return r||(r=this.eventHandlers[t]=new Qt),r.register(e,n)},t.prototype.has=function(t,e){var n=this.eventHandlers&&this.eventHandlers[t];return!!n&&n.has(e)},t.prototype.unregister=function(t,e){var n=this.eventHandlers&&this.eventHandlers[t];n&&n.unregister(e)},t.prototype.clear=function(t){this.eventHandlers&&delete this.eventHandlers[t]},t.prototype.clearAll=function(){this.eventHandlers=void 0},t.prototype.emit=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=this.eventHandlers&&this.eventHandlers[t];i&&(e=i).emit.apply(e,j(n))},t}();function te(t){for(var e=new Array(t.length),n=0;n<t.length;n++)e[n]=t[n];return e}function ee(t,e){return 0===t.indexOf(e)}var ne=function(t,e){};function re(t){"function"==typeof queueMicrotask?queueMicrotask(t):"function"==typeof setImmediate?setImmediate(t):setTimeout(t,1)}function ie(t){return function(t,e){var n=function(){var r=pt(),i=ut();if(!i)throw $t("a mst flow must always have a parent context");var o=ht(i);if(!o)throw $t("a mst flow must always have a parent action context");var a={name:t,id:r,tree:i.tree,context:i.context,parentId:i.id,allParentIds:j(i.allParentIds,[i.id]),rootId:i.rootId,parentEvent:i,parentActionEvent:o},s=arguments;function u(t,e,r){t.$mst_middleware=n.$mst_middleware,ct(C(C({},a),{type:e,args:[r]}),t)}return new Promise((function(t,r){var i,o=function(){i=e.apply(null,arguments),p(void 0)};function p(t){var e;try{u((function(t){e=i.next(t)}),"flow_resume",t)}catch(n){return void re((function(){u((function(t){r(n)}),"flow_throw",n)}))}h(e)}function c(t){var e;try{u((function(t){e=i.throw(t)}),"flow_resume_error",t)}catch(n){return void re((function(){u((function(t){r(n)}),"flow_throw",n)}))}h(e)}function h(e){if(!e.done){if(!e.value||"function"!=typeof e.value.then)throw $t("Only promises can be yielded to `async`, got: "+e);return e.value.then(p,c)}re((function(){u((function(e){t(e)}),"flow_return",e.value)}))}o.$mst_middleware=n.$mst_middleware,ct(C(C({},a),{type:"flow_spawn",args:te(s)}),o)}))};return n}(t.name,t)}function oe(t){switch(t.op){case"add":return{op:"add",path:t.path,value:t.value};case"remove":return{op:"remove",path:t.path};case"replace":return{op:"replace",path:t.path,value:t.value}}}function ae(t){switch(t.op){case"add":return{op:"remove",path:t.path};case"remove":return{op:"add",path:t.path,value:t.oldValue};case"replace":return{op:"replace",path:t.path,value:t.oldValue}}}function se(t){return!0==("number"==typeof t)?""+t:-1===t.indexOf("/")&&-1===t.indexOf("~")?t:t.replace(/~/g,"~0").replace(/\//g,"~1")}function ue(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function pe(t){if(0===t.length)return"";var e=function(t){return t.map(se).join("/")};return"."===t[0]||".."===t[0]?e(t):"/"+e(t)}function ce(t){var e=t.split("/").map(ue);if(!(""===t||"."===t||".."===t||ee(t,"/")||ee(t,"./")||ee(t,"../")))throw $t("a json path must be either rooted, empty or relative, but got '"+t+"'");return""===e[0]&&e.shift(),e}ne.ids={};var he=function(t){function e(e,n,r){var i=t.call(this,r||e.name)||this;return i._subtype=e,i._processors=n,i}return T(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return this._subtype.flags|W.SnapshotProcessor},enumerable:!1,configurable:!0}),e.prototype.describe=function(){return"snapshotProcessor("+this._subtype.describe()+")"},e.prototype.preProcessSnapshot=function(t){return this._processors.preProcessor?this._processors.preProcessor.call(null,t):t},e.prototype.postProcessSnapshot=function(t){return this._processors.postProcessor?this._processors.postProcessor.call(null,t):t},e.prototype._fixNode=function(t){var e=this;!function(t,e){for(var n,r,i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];try{for(var a=O(i),s=a.next();!s.done;s=a.next()){var u=s.value;t[u]=e[u].bind(e)}}catch(p){n={error:p}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}(t.type,this,"isAssignableFrom","create");var n=t.getSnapshot;t.getSnapshot=function(){return e.postProcessSnapshot(n.call(t))}},e.prototype.instantiate=function(t,e,n,r){var i=Nt(r)?r:this.preProcessSnapshot(r),o=this._subtype.instantiate(t,e,n,i);return this._fixNode(o),o},e.prototype.reconcile=function(t,e,n,r){var i=this._subtype.reconcile(t,Nt(e)?e:this.preProcessSnapshot(e),n,r);return i!==t&&this._fixNode(i),i},e.prototype.getSnapshot=function(t,e){void 0===e&&(e=!0);var n=this._subtype.getSnapshot(t);return e?this.postProcessSnapshot(n):n},e.prototype.isValidSnapshot=function(t,e){var n=this.preProcessSnapshot(t);return this._subtype.validate(n,e)},e.prototype.getSubTypes=function(){return this._subtype},e.prototype.is=function(t){var e=tt(t)?this._subtype:Nt(t)?z(t,!1):this.preProcessSnapshot(t);return 0===this._subtype.validate(e,[{path:"",type:this._subtype}]).length},e}(q);var le,fe,de="Map.put can only be used to store complex values that have an identifier type attribute";function ye(t,e){var n,r,i=t.getSubTypes();if("cannotDetermine"===i)return!1;if(i){var o=Jt(i);try{for(var a=O(o),s=a.next();!s.done;s=a.next()){if(!ye(s.value,e))return!1}}catch(u){n={error:u}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}}return t instanceof Ie&&e.push(t),!0}(fe=le||(le={}))[fe.UNKNOWN=0]="UNKNOWN",fe[fe.YES=1]="YES",fe[fe.NO=2]="NO";var ve=function(t){function e(e){return t.call(this,e,v.ref.enhancer)||this}return T(e,t),e.prototype.get=function(e){return t.prototype.get.call(this,""+e)},e.prototype.has=function(e){return t.prototype.has.call(this,""+e)},e.prototype.delete=function(e){return t.prototype.delete.call(this,""+e)},e.prototype.set=function(e,n){return t.prototype.set.call(this,""+e,n)},e.prototype.put=function(t){if(!t)throw $t("Map.put cannot be used to set empty values");if(Nt(t)){var e=jt(t);if(null===e.identifier)throw $t(de);return this.set(e.identifier,t),t}if(Bt(t)){var n=jt(this),r=n.type;if(r.identifierMode!==le.YES)throw $t(de);var i=t[r.mapIdentifierAttribute];if(!cn(i)){var o=this.put(r.getChildType().create(t,n.environment));return this.put(z(o))}var a=pn(i);return this.set(a,t),this.get(a)}throw $t("Map.put can only be used to store complex values")},e}(h),be=function(t){function e(e,n,r){void 0===r&&(r=[]);var i=t.call(this,e)||this;return i._subType=n,i.identifierMode=le.UNKNOWN,i.mapIdentifierAttribute=void 0,i.flags=W.Map,i.hookInitializers=[],i._determineIdentifierMode(),i.hookInitializers=r,i}return T(e,t),e.prototype.hooks=function(t){var n=this.hookInitializers.length>0?this.hookInitializers.concat(t):[t];return new e(this.name,this._subType,n)},e.prototype.instantiate=function(t,e,n,r){return this._determineIdentifierMode(),Vt(this,t,e,n,r)},e.prototype._determineIdentifierMode=function(){if(this.identifierMode===le.UNKNOWN){var t=[];if(ye(this._subType,t)){var e=void 0;t.forEach((function(t){if(t.identifierAttribute){if(e&&e!==t.identifierAttribute)throw $t("The objects in a map should all have the same identifier attribute, expected '"+e+"', but child of type '"+t.name+"' declared attribute '"+t.identifierAttribute+"' as identifier");e=t.identifierAttribute}})),e?(this.identifierMode=le.YES,this.mapIdentifierAttribute=e):this.identifierMode=le.NO}}},e.prototype.initializeChildNodes=function(t,e){void 0===e&&(e={});var n=t.type._subType,r={};return Object.keys(e).forEach((function(i){r[i]=n.instantiate(t,i,void 0,e[i])})),r},e.prototype.createNewInstance=function(t){return new ve(t)},e.prototype.finalizeNewInstance=function(t,e){l(e,t.unbox),t.type.hookInitializers.forEach((function(t){var n=t(e);Object.keys(n).forEach((function(t){var r=n[t],i=lt(e,t,r);qt(e,t,i)}))})),f(e,this.willChange),d(e,this.didChange)},e.prototype.describe=function(){return"Map<string, "+this._subType.describe()+">"},e.prototype.getChildren=function(t){return y(t.storedValue)},e.prototype.getChildNode=function(t,e){var n=t.storedValue.get(""+e);if(!n)throw $t("Not a child "+e);return n},e.prototype.willChange=function(t){var e=jt(t.object),n=t.name;e.assertWritable({subpath:n});var r=e.type,i=r._subType;switch(t.type){case"update":var o=t.newValue;if(o===t.object.get(n))return null;St(i,o),t.newValue=i.reconcile(e.getChildNode(n),t.newValue,e,n),r.processIdentifier(n,t.newValue);break;case"add":St(i,t.newValue),t.newValue=i.instantiate(e,n,void 0,t.newValue),r.processIdentifier(n,t.newValue)}return t},e.prototype.processIdentifier=function(t,e){if(this.identifierMode===le.YES&&e instanceof K){var n=e.identifier;if(n!==t)throw $t("A map of objects containing an identifier should always store the object under their own identifier. Trying to store key '"+n+"', but expected: '"+t+"'")}},e.prototype.getSnapshot=function(t){var e={};return t.getChildren().forEach((function(t){e[t.subpath]=t.snapshot})),e},e.prototype.processInitialSnapshot=function(t){var e={};return Object.keys(t).forEach((function(n){e[n]=t[n].getSnapshot()})),e},e.prototype.didChange=function(t){var e=jt(t.object);switch(t.type){case"update":return void e.emitPatch({op:"replace",path:se(t.name),value:t.newValue.snapshot,oldValue:t.oldValue?t.oldValue.snapshot:void 0},e);case"add":return void e.emitPatch({op:"add",path:se(t.name),value:t.newValue.snapshot,oldValue:void 0},e);case"delete":var n=t.oldValue.snapshot;return t.oldValue.die(),void e.emitPatch({op:"remove",path:se(t.name),oldValue:n},e)}},e.prototype.applyPatchLocally=function(t,e,n){var r=t.storedValue;switch(n.op){case"add":case"replace":r.set(e,n.value);break;case"remove":r.delete(e)}},e.prototype.applySnapshot=function(t,e){St(this,e);var n=t.storedValue,r={};if(Array.from(n.keys()).forEach((function(t){r[t]=!1})),e)for(var i in e)n.set(i,e[i]),r[""+i]=!0;Object.keys(r).forEach((function(t){!1===r[t]&&n.delete(t)}))},e.prototype.getChildType=function(){return this._subType},e.prototype.isValidSnapshot=function(t,e){var n=this;return Zt(t)?Pt(Object.keys(t).map((function(r){return n._subType.validate(t[r],mt(e,r,n._subType))}))):_t(e,t,"Value is not a plain object")},e.prototype.getDefaultSnapshot=function(){return Lt},e.prototype.removeChild=function(t,e){t.storedValue.delete(e)},E([a],e.prototype,"applySnapshot",null),e}(Q);var ge=function(t){function e(e,n,r){void 0===r&&(r=[]);var i=t.call(this,e)||this;return i._subType=n,i.flags=W.Array,i.hookInitializers=[],i.hookInitializers=r,i}return T(e,t),e.prototype.hooks=function(t){var n=this.hookInitializers.length>0?this.hookInitializers.concat(t):[t];return new e(this.name,this._subType,n)},e.prototype.instantiate=function(t,e,n,r){return Vt(this,t,e,n,r)},e.prototype.initializeChildNodes=function(t,e){void 0===e&&(e=[]);var n=t.type._subType,r={};return e.forEach((function(e,i){var o=""+i;r[o]=n.instantiate(t,o,void 0,e)})),r},e.prototype.createNewInstance=function(t){return v.array(Mt(t),Ut)},e.prototype.finalizeNewInstance=function(t,e){b(e).dehancer=t.unbox,t.type.hookInitializers.forEach((function(t){var n=t(e);Object.keys(n).forEach((function(t){var r=n[t],i=lt(e,t,r);qt(e,t,i)}))})),f(e,this.willChange),d(e,this.didChange)},e.prototype.describe=function(){return this._subType.describe()+"[]"},e.prototype.getChildren=function(t){return t.storedValue.slice()},e.prototype.getChildNode=function(t,e){var n=Number(e);if(n<t.storedValue.length)return t.storedValue[n];throw $t("Not a child: "+e)},e.prototype.willChange=function(t){var e=jt(t.object);e.assertWritable({subpath:""+t.index});var n=e.type._subType,r=e.getChildren();switch(t.type){case"update":if(t.newValue===t.object[t.index])return null;var i=me(e,n,[r[t.index]],[t.newValue],[t.index]);if(!i)return null;t.newValue=i[0];break;case"splice":var o=t.index,a=t.removedCount,s=t.added,u=me(e,n,r.slice(o,o+a),s,s.map((function(t,e){return o+e})));if(!u)return null;t.added=u;for(var p=o+a;p<r.length;p++)r[p].setParent(e,""+(p+s.length-a))}return t},e.prototype.getSnapshot=function(t){return t.getChildren().map((function(t){return t.snapshot}))},e.prototype.processInitialSnapshot=function(t){var e=[];return Object.keys(t).forEach((function(n){e.push(t[n].getSnapshot())})),e},e.prototype.didChange=function(t){var e=jt(t.object);switch(t.type){case"update":return void e.emitPatch({op:"replace",path:""+t.index,value:t.newValue.snapshot,oldValue:t.oldValue?t.oldValue.snapshot:void 0},e);case"splice":for(var n=t.removedCount-1;n>=0;n--)e.emitPatch({op:"remove",path:""+(t.index+n),oldValue:t.removed[n].snapshot},e);for(n=0;n<t.addedCount;n++)e.emitPatch({op:"add",path:""+(t.index+n),value:e.getChildNode(""+(t.index+n)).snapshot,oldValue:void 0},e);return}},e.prototype.applyPatchLocally=function(t,e,n){var r=t.storedValue,i="-"===e?r.length:Number(e);switch(n.op){case"replace":r[i]=n.value;break;case"add":r.splice(i,0,n.value);break;case"remove":r.splice(i,1)}},e.prototype.applySnapshot=function(t,e){St(this,e),t.storedValue.replace(e)},e.prototype.getChildType=function(){return this._subType},e.prototype.isValidSnapshot=function(t,e){var n=this;return Yt(t)?Pt(t.map((function(t,r){return n._subType.validate(t,mt(e,""+r,n._subType))}))):_t(e,t,"Value is not an array")},e.prototype.getDefaultSnapshot=function(){return Ht},e.prototype.removeChild=function(t,e){t.storedValue.splice(Number(e),1)},E([a],e.prototype,"applySnapshot",null),e}(Q);function me(t,e,n,r,i){for(var o,a=!0,s=0;;s++){var u=s<=r.length-1,p=n[s],c=u?r[s]:void 0,h=""+i[s];if(((o=c)instanceof J||o instanceof K)&&(c=c.storedValue),!p&&!u)break;if(u)if(p)if(_e(p,c))n[s]=we(e,t,h,c,p);else{for(var l=void 0,f=s;f<n.length;f++)if(_e(n[f],c)){l=n.splice(f,1)[0];break}a=!1;d=we(e,t,h,c,l);n.splice(s,0,d)}else{if(Nt(c)&&jt(c).parent===t)throw $t("Cannot add an object to a state tree if it is already part of the same or another state tree. Tried to assign an object to '"+t.path+"/"+h+"', but it lives already at '"+jt(c).path+"'");a=!1;var d=we(e,t,h,c);n.splice(s,0,d)}else a=!1,n.splice(s,1),p instanceof K&&p.createObservableInstanceIfNeeded(),p.die(),s--}return a?null:n}function we(t,e,n,r,i){St(t,r);var o=function(){if(Nt(r)){var o=jt(r);if(o.assertAlive(Lt),null!==o.parent&&o.parent===e)return o.setParent(e,n),o}return i?t.reconcile(i,r,e,n):t.instantiate(e,n,void 0,r)}();return i&&i!==o&&(i instanceof K&&i.createObservableInstanceIfNeeded(),i.die()),o}function _e(t,e){if(!t.isAlive)return!1;if(Nt(e)){var n=jt(e);return n.isAlive&&n===t}return t.snapshot===e||t instanceof K&&null!==t.identifier&&t.identifierAttribute&&Zt(e)&&t.identifier===pn(e[t.identifierAttribute])&&t.type.is(e)}function Pe(){return jt(this).toString()}var Se={name:"AnonymousModel",properties:{},initializers:Ht};function Ae(t){return Object.keys(t).reduce((function(t,e){var n,r,i;if(e in w)throw $t("Hook '"+e+"' was defined as property. Hooks should be defined as part of the actions");var o=Object.getOwnPropertyDescriptor(t,e);if("get"in o)throw $t("Getters are not supported as properties. Please use views instead");var a=o.value;if(null==a)throw $t("The default value of an attribute cannot be null or undefined as the type cannot be inferred. Did you mean `types.maybe(someType)`?");if(Kt(a))return Object.assign({},t,((n={})[e]=$e(function(t){switch(typeof t){case"string":return Ee;case"number":return Ve;case"boolean":return Ne;case"object":if(t instanceof Date)return ke}throw $t("Cannot determine primitive type from value "+t)}(a),a),n));if(a instanceof be)return Object.assign({},t,((r={})[e]=$e(a,{}),r));if(a instanceof ge)return Object.assign({},t,((i={})[e]=$e(a,[]),i));if(tt(a))return t;throw $t("Invalid type definition for property '"+e+"', cannot infer a type from a value like '"+a+"' ("+typeof a+")")}),t)}var Ie=function(t){function n(e){var n=t.call(this,e.name||Se.name)||this;return n.flags=W.Object,n.named=function(t){return n.cloneAndEnhance({name:t})},n.props=function(t){return n.cloneAndEnhance({properties:t})},n.preProcessSnapshot=function(t){var e=n.preProcessor;return e?n.cloneAndEnhance({preProcessor:function(n){return e(t(n))}}):n.cloneAndEnhance({preProcessor:t})},n.postProcessSnapshot=function(t){var e=n.postProcessor;return e?n.cloneAndEnhance({postProcessor:function(n){return t(e(n))}}):n.cloneAndEnhance({postProcessor:t})},Object.assign(n,Se,e),n.properties=Ae(n.properties),n.properties,n.propertyNames=Object.keys(n.properties),n.identifierAttribute=n._getIdentifierAttribute(),n}return T(n,t),n.prototype._getIdentifierAttribute=function(){var t=void 0;return this.forAllProps((function(e,n){if(n.flags&W.Identifier){if(t)throw $t("Cannot define property '"+e+"' as object identifier, property '"+t+"' is already defined as identifier property");t=e}})),t},n.prototype.cloneAndEnhance=function(t){return new n({name:t.name||this.name,properties:Object.assign({},this.properties,t.properties),initializers:this.initializers.concat(t.initializers||[]),preProcessor:t.preProcessor||this.preProcessor,postProcessor:t.postProcessor||this.postProcessor})},n.prototype.actions=function(t){var e=this;return this.cloneAndEnhance({initializers:[function(n){return e.instantiateActions(n,t(n)),n}]})},n.prototype.instantiateActions=function(t,e){if(!Zt(e))throw $t("actions initializer should return a plain object containing actions");Object.keys(e).forEach((function(n){if("preProcessSnapshot"===n)throw $t("Cannot define action 'preProcessSnapshot', it should be defined using 'type.preProcessSnapshot(fn)' instead");if("postProcessSnapshot"===n)throw $t("Cannot define action 'postProcessSnapshot', it should be defined using 'type.postProcessSnapshot(fn)' instead");var r=e[n],i=t[n];if(n in w&&i){var o=r;r=function(){i.apply(null,arguments),o.apply(null,arguments)}}var a=r.$mst_middleware,s=r.bind(e);s.$mst_middleware=a;var u=lt(t,n,s);e[n]=u,qt(t,n,u)}))},n.prototype.volatile=function(t){var e=this;if("function"!=typeof t)throw $t("You passed an "+typeof t+" to volatile state as an argument, when function is expected");return this.cloneAndEnhance({initializers:[function(n){return e.instantiateVolatileState(n,t(n)),n}]})},n.prototype.instantiateVolatileState=function(t,e){if(!Zt(e))throw $t("volatile state initializer should return a plain object containing state");g(t,e)},n.prototype.extend=function(t){var e=this;return this.cloneAndEnhance({initializers:[function(n){var r=t(n),i=r.actions,o=r.views,a=r.state,s=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}(r,["actions","views","state"]);for(var u in s)throw $t("The `extend` function should return an object with a subset of the fields 'actions', 'views' and 'state'. Found invalid key '"+u+"'");return a&&e.instantiateVolatileState(n,a),o&&e.instantiateViews(n,o),i&&e.instantiateActions(n,i),n}]})},n.prototype.views=function(t){var e=this;return this.cloneAndEnhance({initializers:[function(n){return e.instantiateViews(n,t(n)),n}]})},n.prototype.instantiateViews=function(t,n){if(!Zt(n))throw $t("views initializer should return a plain object containing views");Object.keys(n).forEach((function(r){var i=Object.getOwnPropertyDescriptor(n,r);if("get"in i)if(e(t,r)){var o=b(t,r);o.derivation=i.get,o.scope=t,i.set&&(o.setter=a(o.name+"-setter",i.set))}else s(t,r,i,!0);else{if("function"!=typeof i.value)throw $t("A view member should either be a function or getter based property");qt(t,r,i.value)}}))},n.prototype.instantiate=function(t,e,n,r){return Vt(this,t,e,n,Nt(r)?r:this.applySnapshotPreProcessor(r))},n.prototype.initializeChildNodes=function(t,e){void 0===e&&(e={});var n=t.type,r={};return n.forAllProps((function(n,i){r[n]=i.instantiate(t,n,void 0,e[n])})),r},n.prototype.createNewInstance=function(t){return v.object(t,Lt,Ut)},n.prototype.finalizeNewInstance=function(t,e){qt(e,"toString",Pe),this.forAllProps((function(n){l(e,n,t.unbox)})),this.initializers.reduce((function(t,e){return e(t)}),e),f(e,this.willChange),d(e,this.didChange)},n.prototype.willChange=function(t){var e=t,n=jt(e.object),r=e.name;n.assertWritable({subpath:r});var i=n.type.properties[r];return i&&(St(i,e.newValue),e.newValue=i.reconcile(n.getChildNode(r),e.newValue,n,r)),e},n.prototype.didChange=function(t){var e=t,n=jt(e.object);if(n.type.properties[e.name]){var r=e.oldValue?e.oldValue.snapshot:void 0;n.emitPatch({op:"replace",path:se(e.name),value:e.newValue.snapshot,oldValue:r},n)}},n.prototype.getChildren=function(t){var e=this,n=[];return this.forAllProps((function(r){n.push(e.getChildNode(t,r))})),n},n.prototype.getChildNode=function(t,e){if(!(e in this.properties))throw $t("Not a value property: "+e);var n=b(t.storedValue,e).value;if(!n)throw $t("Node not available for property "+e);return n},n.prototype.getSnapshot=function(t,e){var n=this;void 0===e&&(e=!0);var r={};return this.forAllProps((function(e,i){c(t.storedValue,e).reportObserved(),r[e]=n.getChildNode(t,e).snapshot})),e?this.applySnapshotPostProcessor(r):r},n.prototype.processInitialSnapshot=function(t){var e={};return Object.keys(t).forEach((function(n){e[n]=t[n].getSnapshot()})),this.applySnapshotPostProcessor(e)},n.prototype.applyPatchLocally=function(t,e,n){if("replace"!==n.op&&"add"!==n.op)throw $t("object does not support operation "+n.op);t.storedValue[e]=n.value},n.prototype.applySnapshot=function(t,e){var n=this.applySnapshotPreProcessor(e);St(this,n),this.forAllProps((function(e){t.storedValue[e]=n[e]}))},n.prototype.applySnapshotPreProcessor=function(t){var e=this.preProcessor;return e?e.call(null,t):t},n.prototype.applySnapshotPostProcessor=function(t){var e=this.postProcessor;return e?e.call(null,t):t},n.prototype.getChildType=function(t){return this.properties[t]},n.prototype.isValidSnapshot=function(t,e){var n=this,r=this.applySnapshotPreProcessor(t);return Zt(r)?Pt(this.propertyNames.map((function(t){return n.properties[t].validate(r[t],mt(e,t,n.properties[t]))}))):_t(e,r,"Value is not a plain object")},n.prototype.forAllProps=function(t){var e=this;this.propertyNames.forEach((function(n){return t(n,e.properties[n])}))},n.prototype.describe=function(){var t=this;return"{ "+this.propertyNames.map((function(e){return e+": "+t.properties[e].describe()})).join("; ")+" }"},n.prototype.getDefaultSnapshot=function(){return Lt},n.prototype.removeChild=function(t,e){t.storedValue[e]=void 0},E([a],n.prototype,"applySnapshot",null),n}(Q);function Te(t){return tt(t)&&(t.flags&W.Object)>0}var Ce=function(t){function e(e,n,r,i){void 0===i&&(i=Wt);var o=t.call(this,e)||this;return o.flags=n,o.checker=r,o.initializer=i,o.flags=n,o}return T(e,t),e.prototype.describe=function(){return this.name},e.prototype.instantiate=function(t,e,n,r){return Ot(this,t,e,n,r)},e.prototype.createNewInstance=function(t){return this.initializer(t)},e.prototype.isValidSnapshot=function(t,e){return Kt(t)&&this.checker(t)?wt():_t(e,t,"Value is not a "+("Date"===this.name?"Date or a unix milliseconds timestamp":this.name))},e}(X),Ee=new Ce("string",W.String,(function(t){return"string"==typeof t})),Ve=new Ce("number",W.Number,(function(t){return"number"==typeof t})),Oe=new Ce("integer",W.Integer,(function(t){return Gt(t)})),Ne=new Ce("boolean",W.Boolean,(function(t){return"boolean"==typeof t})),je=new Ce("null",W.Null,(function(t){return null===t})),De=new Ce("undefined",W.Undefined,(function(t){return void 0===t})),xe=new Ce("Date",W.Date,(function(t){return"number"==typeof t||t instanceof Date}),(function(t){return t instanceof Date?t:new Date(t)}));xe.getSnapshot=function(t){return t.storedValue.getTime()};var ke=xe;function Re(t){return tt(t)&&(t.flags&(W.String|W.Number|W.Integer|W.Boolean|W.Date))>0}var ze=function(t){function e(e){var n=t.call(this,JSON.stringify(e))||this;return n.flags=W.Literal,n.value=e,n}return T(e,t),e.prototype.instantiate=function(t,e,n,r){return Ot(this,t,e,n,r)},e.prototype.describe=function(){return JSON.stringify(this.value)},e.prototype.isValidSnapshot=function(t,e){return Kt(t)&&t===this.value?wt():_t(e,t,"Value is not a literal "+JSON.stringify(this.value))},e}(X);function Fe(t){return new ze(t)}var Me=function(t){function e(e,n,r,i){var o=t.call(this,e)||this;return o._subtype=n,o._predicate=r,o._message=i,o}return T(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return this._subtype.flags|W.Refinement},enumerable:!1,configurable:!0}),e.prototype.describe=function(){return this.name},e.prototype.instantiate=function(t,e,n,r){return this._subtype.instantiate(t,e,n,r)},e.prototype.isAssignableFrom=function(t){return this._subtype.isAssignableFrom(t)},e.prototype.isValidSnapshot=function(t,e){var n=this._subtype.validate(t,e);if(n.length>0)return n;var r=Nt(t)?jt(t).snapshot:t;return this._predicate(r)?wt():_t(e,t,this._message(t))},e.prototype.reconcile=function(t,e,n,r){return this._subtype.reconcile(t,e,n,r)},e.prototype.getSubTypes=function(){return this._subtype},e}(q);var He=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i._types=n,i._eager=!0,r=C({eager:!0,dispatcher:void 0},r),i._dispatcher=r.dispatcher,r.eager||(i._eager=!1),i}return T(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){var t=W.Union;return this._types.forEach((function(e){t|=e.flags})),t},enumerable:!1,configurable:!0}),e.prototype.isAssignableFrom=function(t){return this._types.some((function(e){return e.isAssignableFrom(t)}))},e.prototype.describe=function(){return"("+this._types.map((function(t){return t.describe()})).join(" | ")+")"},e.prototype.instantiate=function(t,e,n,r){var i=this.determineType(r,void 0);if(!i)throw $t("No matching type for union "+this.describe());return i.instantiate(t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){var i=this.determineType(e,t.type);if(!i)throw $t("No matching type for union "+this.describe());return i.reconcile(t,e,n,r)},e.prototype.determineType=function(t,e){return this._dispatcher?this._dispatcher(t):e?e.is(t)?e:this._types.filter((function(t){return t!==e})).find((function(e){return e.is(t)})):this._types.find((function(e){return e.is(t)}))},e.prototype.isValidSnapshot=function(t,e){if(this._dispatcher)return this._dispatcher(t).validate(t,e);for(var n=[],r=0,i=0;i<this._types.length;i++){var o=this._types[i].validate(t,e);if(0===o.length){if(this._eager)return wt();r++}else n.push(o)}return 1===r?wt():_t(e,t,"No type is applicable for the union").concat(Pt(n))},e.prototype.getSubTypes=function(){return this._types},e}(q);function Le(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=tt(t)?void 0:t,i=tt(t)?j([t],e):e,o="("+i.map((function(t){return t.name})).join(" | ")+")";return new He(o,i,r)}var Ue=function(t){function e(e,n,r){var i=t.call(this,e.name)||this;return i._subtype=e,i._defaultValue=n,i.optionalValues=r,i}return T(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return this._subtype.flags|W.Optional},enumerable:!1,configurable:!0}),e.prototype.describe=function(){return this._subtype.describe()+"?"},e.prototype.instantiate=function(t,e,n,r){if(this.optionalValues.indexOf(r)>=0){var i=this.getDefaultInstanceOrSnapshot();return this._subtype.instantiate(t,e,n,i)}return this._subtype.instantiate(t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){return this._subtype.reconcile(t,this.optionalValues.indexOf(e)<0&&this._subtype.is(e)?e:this.getDefaultInstanceOrSnapshot(),n,r)},e.prototype.getDefaultInstanceOrSnapshot=function(){var t="function"==typeof this._defaultValue?this._defaultValue():this._defaultValue;return"function"==typeof this._defaultValue&&St(this,t),t},e.prototype.isValidSnapshot=function(t,e){return this.optionalValues.indexOf(t)>=0?wt():this._subtype.validate(t,e)},e.prototype.isAssignableFrom=function(t){return this._subtype.isAssignableFrom(t)},e.prototype.getSubTypes=function(){return this._subtype},e}(q);function $e(t,e,n){return function(t,e){if("function"!=typeof e&&Nt(e))throw $t("default value cannot be an instance, pass a snapshot or a function that creates an instance/snapshot instead")}(0,e),new Ue(t,e,n||We)}var We=[void 0];var Ge=$e(De,void 0),Ye=$e(je,null);function Je(t){return Le(t,Ge)}var Ze=function(t){function e(e,n){var r=t.call(this,e)||this;return r._definition=n,r}return T(e,t),Object.defineProperty(e.prototype,"flags",{get:function(){return(this._subType?this._subType.flags:0)|W.Late},enumerable:!1,configurable:!0}),e.prototype.getSubType=function(t){if(!this._subType){var e=void 0;try{e=this._definition()}catch(n){if(!(n instanceof ReferenceError))throw n;e=void 0}if(t&&void 0===e)throw $t("Late type seems to be used too early, the definition (still) returns undefined");e&&(this._subType=e)}return this._subType},e.prototype.instantiate=function(t,e,n,r){return this.getSubType(!0).instantiate(t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){return this.getSubType(!0).reconcile(t,e,n,r)},e.prototype.describe=function(){var t=this.getSubType(!1);return t?t.name:"<uknown late type>"},e.prototype.isValidSnapshot=function(t,e){var n=this.getSubType(!1);return n?n.validate(t,e):wt()},e.prototype.isAssignableFrom=function(t){var e=this.getSubType(!1);return!!e&&e.isAssignableFrom(t)},e.prototype.getSubTypes=function(){var t=this.getSubType(!1);return t||"cannotDetermine"},e}(q);var Be=function(t){function e(e){var n=t.call(this,e?"frozen("+e.name+")":"frozen")||this;return n.subType=e,n.flags=W.Frozen,n}return T(e,t),e.prototype.describe=function(){return"<any immutable value>"},e.prototype.instantiate=function(t,e,n,r){return Ot(this,t,e,n,r)},e.prototype.isValidSnapshot=function(t,e){return function(t){return"function"!=typeof t}(t)?this.subType?this.subType.validate(t,e):wt():_t(e,t,"Value is not serializable and cannot be frozen")},e}(X),Ke=new Be;var qe=function(){function t(t,e){if(this.targetType=e,cn(t))this.identifier=t;else{if(!Nt(t))throw $t("Can only store references to tree nodes or identifiers, got: '"+t+"'");var n=jt(t);if(!n.identifierAttribute)throw $t("Can only store references with a defined identifier attribute.");var r=n.unnormalizedIdentifier;if(null==r)throw $t("Can only store references to tree nodes with a defined identifier.");this.identifier=r}}return t.prototype.updateResolvedReference=function(t){var e=pn(this.identifier),n=t.root,r=n.identifierCache.getLastCacheModificationPerId(e);if(!this.resolvedReference||this.resolvedReference.lastCacheModification!==r){var i=this.targetType,o=n.identifierCache.resolve(i,e);if(!o)throw new Qe("[mobx-state-tree] Failed to resolve reference '"+this.identifier+"' to type '"+this.targetType.name+"' (from node: "+t.path+")");this.resolvedReference={node:o,lastCacheModification:r}}},Object.defineProperty(t.prototype,"resolvedValue",{get:function(){return this.updateResolvedReference(this.node),this.resolvedReference.node.value},enumerable:!1,configurable:!0}),t}(),Qe=function(t){function e(n){var r=t.call(this,n)||this;return Object.setPrototypeOf(r,e.prototype),r}return T(e,t),e}(Error),Xe=function(t){function e(e,n){var r=t.call(this,"reference("+e.name+")")||this;return r.targetType=e,r.onInvalidated=n,r.flags=W.Reference,r}return T(e,t),e.prototype.describe=function(){return this.name},e.prototype.isAssignableFrom=function(t){return this.targetType.isAssignableFrom(t)},e.prototype.isValidSnapshot=function(t,e){return cn(t)?wt():_t(e,t,"Value is not a valid identifier, which is a string or a number")},e.prototype.fireInvalidated=function(t,e,n,r){var i=e.parent;if(i&&i.isAlive){var o=i.storedValue;o&&this.onInvalidated({cause:t,parent:o,invalidTarget:r?r.storedValue:void 0,invalidId:n,replaceRef:function(t){k(e.root.storedValue,{op:"replace",value:t,path:e.path})},removeRef:function(){Te(i.type)?this.replaceRef(void 0):k(e.root.storedValue,{op:"remove",path:e.path})}})}},e.prototype.addTargetNodeWatcher=function(t,e){var n=this,r=this.getValue(t);if(r){var i=jt(r),o=function(r,o){var a=function(t){switch(t){case w.beforeDestroy:return"destroy";case w.beforeDetach:return"detach";default:return}}(o);a&&n.fireInvalidated(a,t,e,i)},a=i.registerHook(w.beforeDetach,o),s=i.registerHook(w.beforeDestroy,o);return function(){a(),s()}}},e.prototype.watchTargetNodeForInvalidations=function(t,e,n){var r=this;if(this.onInvalidated){var i;t.registerHook(w.beforeDestroy,(function(){i&&i()}));var o=function(o){i&&i();var a=t.parent,s=a&&a.storedValue;if(a&&a.isAlive&&s){(n?!!n.get(e,s):t.root.identifierCache.has(r.targetType,pn(e)))?i=r.addTargetNodeWatcher(t,e):o||r.fireInvalidated("invalidSnapshotReference",t,e,null)}};t.state===It.FINALIZED?o(!0):(t.isRoot||t.root.registerHook(w.afterCreationFinalization,(function(){t.parent&&t.parent.createObservableInstanceIfNeeded()})),t.registerHook(w.afterAttach,(function(){o(!1)})))}},e}(X),tn=function(t){function e(e,n){return t.call(this,e,n)||this}return T(e,t),e.prototype.getValue=function(t){if(t.isAlive)return t.storedValue.resolvedValue},e.prototype.getSnapshot=function(t){return t.storedValue.identifier},e.prototype.instantiate=function(t,e,n,r){var i=Nt(r)?H(r):r,o=new qe(r,this.targetType),a=Ot(this,t,e,n,o);return o.node=a,this.watchTargetNodeForInvalidations(a,i,void 0),a},e.prototype.reconcile=function(t,e,n,r){if(!t.isDetaching&&t.type===this){var i=Nt(e),o=t.storedValue;if(!i&&o.identifier===e||i&&o.resolvedValue===e)return t.setParent(n,r),t}var a=this.instantiate(n,r,void 0,e);return t.die(),a},e}(Xe),en=function(t){function e(e,n,r){var i=t.call(this,e,r)||this;return i.options=n,i}return T(e,t),e.prototype.getValue=function(t){if(t.isAlive)return this.options.get(t.storedValue,t.parent?t.parent.storedValue:null)},e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.instantiate=function(t,e,n,r){var i=Nt(r)?this.options.set(r,t?t.storedValue:null):r,o=Ot(this,t,e,n,i);return this.watchTargetNodeForInvalidations(o,i,this.options),o},e.prototype.reconcile=function(t,e,n,r){var i=Nt(e)?this.options.set(e,t?t.storedValue:null):e;if(!t.isDetaching&&t.type===this&&t.storedValue===i)return t.setParent(n,r),t;var o=this.instantiate(n,r,void 0,i);return t.die(),o},e}(Xe);function nn(t,e){var n=e||void 0,r=e?e.onInvalidated:void 0;return n&&(n.get||n.set)?new en(t,{get:n.get,set:n.set},r):new tn(t,r)}var rn=function(t){function e(e,n){var r=t.call(this,e)||this;return r.validType=n,r.flags=W.Identifier,r}return T(e,t),e.prototype.instantiate=function(t,e,n,r){if(!(t&&t.type instanceof Ie))throw $t("Identifier types can only be instantiated as direct child of a model type");return Ot(this,t,e,n,r)},e.prototype.reconcile=function(t,e,n,r){if(t.storedValue!==e)throw $t("Tried to change identifier from '"+t.storedValue+"' to '"+e+"'. Changing identifiers is not allowed.");return t.setParent(n,r),t},e.prototype.isValidSnapshot=function(t,e){return typeof t!==this.validType?_t(e,t,"Value is not a valid "+this.describe()+", expected a "+this.validType):wt()},e}(X),on=function(t){function e(){var e=t.call(this,"identifier","string")||this;return e.flags=W.Identifier,e}return T(e,t),e.prototype.describe=function(){return"identifier"},e}(rn),an=function(t){function e(){return t.call(this,"identifierNumber","number")||this}return T(e,t),e.prototype.getSnapshot=function(t){return t.storedValue},e.prototype.describe=function(){return"identifierNumber"},e}(rn),sn=new on,un=new an;function pn(t){return""+t}function cn(t){return"string"==typeof t||"number"==typeof t}var hn=function(t){function e(e){var n=t.call(this,e.name)||this;return n.options=e,n.flags=W.Custom,n}return T(e,t),e.prototype.describe=function(){return this.name},e.prototype.isValidSnapshot=function(t,e){if(this.options.isTargetType(t))return wt();var n=this.options.getValidationMessage(t);return n?_t(e,t,"Invalid value for type '"+this.name+"': "+n):wt()},e.prototype.getSnapshot=function(t){return this.options.toSnapshot(t.storedValue)},e.prototype.instantiate=function(t,e,n,r){return Ot(this,t,e,n,this.options.isTargetType(r)?r:this.options.fromSnapshot(r,t&&t.root.environment))},e.prototype.reconcile=function(t,e,n,r){var i=!this.options.isTargetType(e);if(!t.isDetaching&&(t.type===this&&(i?e===t.snapshot:e===t.storedValue)))return t.setParent(n,r),t;var o=i?this.options.fromSnapshot(e,n.root.environment):e,a=this.instantiate(n,r,void 0,o);return t.die(),a},e}(X),ln={enumeration:function(t,e){var n="string"==typeof t?e:t,r=Le.apply(void 0,j(n.map((function(t){return Fe(""+t)}))));return"string"==typeof t&&(r.name=t),r},model:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0]?t.shift():"AnonymousModel",r=t.shift()||{};return new Ie({name:n,properties:r})},compose:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0],r=n?t[0]:"AnonymousModel";return n&&t.shift(),t.reduce((function(t,e){return t.cloneAndEnhance({name:t.name+"_"+e.name,properties:e.properties,initializers:e.initializers,preProcessor:function(n){return e.applySnapshotPreProcessor(t.applySnapshotPreProcessor(n))},postProcessor:function(n){return e.applySnapshotPostProcessor(t.applySnapshotPostProcessor(n))}})})).named(r)},custom:function(t){return new hn(t)},reference:nn,safeReference:function(t,e){var n=nn(t,C(C({},e),{onInvalidated:function(t){e&&e.onInvalidated&&e.onInvalidated(t),t.removeRef()}}));return e&&!1===e.acceptsUndefined?n:Je(n)},union:Le,optional:$e,literal:Fe,maybe:Je,maybeNull:function(t){return Le(t,Ye)},refinement:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="string"==typeof t[0]?t.shift():tt(t[0])?t[0].name:null,r=t[0],i=t[1],o=t[2]?t[2]:function(t){return"Value does not respect the refinement predicate"};return new Me(n,r,i,o)},string:Ee,boolean:Ne,number:Ve,integer:Oe,Date:ke,map:function(t){return new be("map<string, "+t.name+">",t)},array:function(t){return new ge(t.name+"[]",t)},frozen:function(t){return 0===arguments.length?Ke:tt(t)?new Be(t):$e(Ke,t)},identifier:sn,identifierNumber:un,late:function(t,e){var n="string"==typeof t?t:"late("+t.toString()+")";return new Ze(n,"string"==typeof t?e:t)},undefined:De,null:je,snapshotProcessor:function(t,e,n){return new he(t,e,n)}},fn=Object.freeze(Object.defineProperty({__proto__:null,addDisposer:function(t,e){return jt(t).addDisposer(e),e},addMiddleware:ft,applyAction:it,applyPatch:k,applySnapshot:R,cast:function(t){return t},castFlowReturn:function(t){return t},castToReferenceSnapshot:function(t){return t},castToSnapshot:function(t){return t},clone:function(t,e){void 0===e&&(e=!0);var n=jt(t);return n.type.create(n.snapshot,!0===e?n.root.environment:!1===e?void 0:e)},createActionTrackingMiddleware:function(t){return function(e,n,r){switch(e.type){case"action":if(t.filter&&!0!==t.filter(e))return n(e);var i=t.onStart(e);t.onResume(e,i),et.set(e.id,{call:e,context:i,async:!1});try{var o=n(e);return t.onSuspend(e,i),!1===et.get(e.id).async&&(et.delete(e.id),t.onSuccess(e,i,o)),o}catch(s){throw et.delete(e.id),t.onFail(e,i,s),s}case"flow_spawn":return(a=et.get(e.rootId)).async=!0,n(e);case"flow_resume":case"flow_resume_error":var a=et.get(e.rootId);t.onResume(e,a.context);try{return n(e)}finally{t.onSuspend(e,a.context)}case"flow_throw":a=et.get(e.rootId);return et.delete(e.rootId),t.onFail(e,a.context,e.args[0]),n(e);case"flow_return":a=et.get(e.rootId);return et.delete(e.rootId),t.onSuccess(e,a.context,e.args[0]),n(e)}}},createActionTrackingMiddleware2:function(t){var e=new WeakMap;return function(n,r){var i=n.parentActionEvent?e.get(n.parentActionEvent):void 0;if("action"===n.type){var o=C(C({},n),{env:i&&i.call.env,parentCall:i&&i.call}),a=!t.filter||t.filter(o),s=new nt(a?t:void 0,o);e.set(n,s);var u=void 0;try{u=r(n)}catch(c){throw s.finish(c),c}return s.hasFlowsPending||s.finish(),u}if(!i)return r(n);switch(n.type){case"flow_spawn":return i.incFlowsPending(),r(n);case"flow_resume":case"flow_resume_error":return r(n);case"flow_throw":var p=n.args[0];try{return r(n)}finally{i.decFlowsPending(),i.hasFlowsPending||i.finish(p)}case"flow_return":try{return r(n)}finally{i.decFlowsPending(),i.hasFlowsPending||i.finish()}}}},decorate:function(t,e,n){void 0===n&&(n=!0);var r={handler:t,includeHooks:n};return e.$mst_middleware=e.$mst_middleware||[],e.$mst_middleware.push(r),e},destroy:function(t){var e=jt(t);e.isRoot?e.die():e.parent.removeChild(e.subpath)},detach:function(t){return jt(t).detach(),t},escapeJsonPath:se,flow:ie,getChildType:function(t,e){return jt(t).getChildType(e)},getEnv:function(t){var e=jt(t).root.environment;return e||Lt},getIdentifier:H,getLivelinessChecking:A,getMembers:function(t){var r=jt(t).type,i=C(C({},$(r)),{actions:[],volatile:[],views:[]});return Object.getOwnPropertyNames(t).forEach((function(r){if(!(r in i.properties)){var o=Object.getOwnPropertyDescriptor(t,r);o.get?e(t,r)?i.views.push(r):i.volatile.push(r):!0===o.value._isMSTAction?i.actions.push(r):n(t,r)?i.volatile.push(r):i.views.push(r)}})),i},getNodeId:function(t){return jt(t).nodeId},getParent:function(t,e){void 0===e&&(e=1);for(var n=e,r=jt(t).parent;r;){if(0==--n)return r.storedValue;r=r.parent}throw $t("Failed to find the parent of "+jt(t)+" at depth "+e)},getParentOfType:function(t,e){for(var n=jt(t).parent;n;){if(e.is(n.storedValue))return n.storedValue;n=n.parent}throw $t("Failed to find the parent of "+jt(t)+" of a given type")},getPath:M,getPathParts:function(t){return ce(jt(t).path)},getPropertyMembers:$,getRelativePath:function(t,e){return Rt(jt(t),jt(e))},getRoot:F,getRunningActionContext:yt,getSnapshot:z,getType:D,hasParent:function(t,e){void 0===e&&(e=1);for(var n=jt(t).parent;n;){if(0==--e)return!0;n=n.parent}return!1},hasParentOfType:function(t,e){for(var n=jt(t).parent;n;){if(e.is(n.storedValue))return!0;n=n.parent}return!1},isActionContextChildOf:function(t,e){return vt(t,e,!1)},isActionContextThisOrChildOf:function(t,e){return vt(t,e,!0)},isAlive:U,isArrayType:function(t){return tt(t)&&(t.flags&W.Array)>0},isFrozenType:function(t){return tt(t)&&(t.flags&W.Frozen)>0},isIdentifierType:function(t){return tt(t)&&(t.flags&W.Identifier)>0},isLateType:function(t){return tt(t)&&(t.flags&W.Late)>0},isLiteralType:function(t){return tt(t)&&(t.flags&W.Literal)>0},isMapType:function(t){return tt(t)&&(t.flags&W.Map)>0},isModelType:Te,isOptionalType:function(t){return tt(t)&&(t.flags&W.Optional)>0},isPrimitiveType:Re,isProtected:function(t){return jt(t).isProtected},isReferenceType:function(t){return(t.flags&W.Reference)>0},isRefinementType:function(t){return(t.flags&W.Refinement)>0},isRoot:function(t){return jt(t).isRoot},isStateTreeNode:Nt,isType:tt,isUnionType:function(t){return(t.flags&W.Union)>0},isValidReference:function(t,e){void 0===e&&(e=!0);try{var n=t();if(null==n)return!1;if(Nt(n))return!e||U(n);throw $t("The reference to be checked is not one of node, null or undefined")}catch(r){if(r instanceof Qe)return!1;throw r}},joinJsonPath:pe,onAction:ot,onPatch:x,onSnapshot:function(t,e){return jt(t).onSnapshot(e)},process:function(t){return ne("process","`process()` has been renamed to `flow()`. See https://github.com/mobxjs/mobx-state-tree/issues/399 for more information. Note that the middleware event types starting with `process` now start with `flow`."),ie(t)},protect:function(t){var e=jt(t);if(!e.isRoot)throw $t("`protect` can only be invoked on root nodes");e.isProtectionEnabled=!0},recordActions:function(t,e){var n,r=[],i=function(t){(!e||e(t,yt()))&&r.push(t)},o={actions:r,get recording(){return!!n},stop:function(){n&&(n(),n=void 0)},resume:function(){n||(n=ot(t,i))},replay:function(t){it(t,r)}};return o.resume(),o},recordPatches:function(t,e){var n,r={patches:[],reversedInversePatches:[]},i={},o={get recording(){return!!n},get patches(){return i.patches||(i.patches=r.patches.slice()),i.patches},get reversedInversePatches(){return i.reversedInversePatches||(i.reversedInversePatches=r.reversedInversePatches.slice()),i.reversedInversePatches},get inversePatches(){return i.inversePatches||(i.inversePatches=r.reversedInversePatches.slice().reverse()),i.inversePatches},stop:function(){n&&(n(),n=void 0)},resume:function(){n||(n=x(t,(function(t,n){e&&!e(t,n,yt())||(r.patches.push(t),r.reversedInversePatches.unshift(n),i.patches=void 0,i.inversePatches=void 0,i.reversedInversePatches=void 0)})))},replay:function(e){k(e||t,r.patches)},undo:function(e){k(e||t,r.reversedInversePatches)}};return o.resume(),o},resolveIdentifier:function(t,e,n){var r=jt(e).root.identifierCache.resolve(t,pn(n));return r?r.value:void 0},resolvePath:function(t,e){var n=zt(jt(t),e);return n?n.value:void 0},setLivelinessChecking:S,setLivelynessChecking:function(t){S(t)},splitJsonPath:ce,toGenerator:function(t){return V(this,(function(e){switch(e.label){case 0:return[4,t];case 1:return[2,e.sent()]}}))},toGeneratorFunction:function(t){return function(){var e,n=[];for(e=0;e<arguments.length;e++)n[e]=arguments[e];return V(this,(function(e){switch(e.label){case 0:return[4,t.apply(void 0,j(n))];case 1:return[2,e.sent()]}}))}},tryReference:function(t,e){void 0===e&&(e=!0);try{var n=t();if(null==n)return;if(Nt(n))return e?U(n)?n:void 0:n;throw $t("The reference to be checked is not one of node, null or undefined")}catch(r){if(r instanceof Qe)return;throw r}},tryResolve:L,typecheck:At,types:ln,unescapeJsonPath:ue,unprotect:function(t){var e=jt(t);if(!e.isRoot)throw $t("`unprotect` can only be invoked on root nodes");e.isProtectionEnabled=!1},walk:function t(e,n){var r=jt(e);r.getChildren().forEach((function(e){Nt(e.storedValue)&&t(e.storedValue,n)})),n(r.storedValue)}},Symbol.toStringTag,{value:"Module"})),dn=t(fn);export{dn as r};
