import{r as e}from"../react-dom/react-dom.fd66ae9b.js";import{r as t,R as o}from"../react/react.892b78e7.js";import{e as r,b as a,d as n}from"../@babel/@babel.2f68c20c.js";import{j as i,a as s}from"../@arco-design/@arco-design.94e981f9.js";function p(e,o,r){void 0===r&&(r=[]),r.forEach((r=>{var a=""+r.charAt(0).toLowerCase()+r.slice(1),[n,i]=t.exports.useState(o[a]);t.exports.useEffect((()=>{if(e&&e["set"+r]&&void 0!==o[a]){var t=o[a];if(t&&t.lng&&t.lat){t=new BMap.Point(t.lng,t.lat);var s=n;if(s&&s.lng&&s.lat&&(s=new BMap.Point(s.lng,s.lat),t.equals(s)))return}e["set"+r](t),n!==o[a]&&("bounds"===a?n&&o[a]&&!n.equals(o[a])&&i(o[a]):i(o[a]))}}),[e,o[a]])}))}var c={};function l(e){var t=document&&(document.head||document.getElementsByTagName("head")[0]);return new Promise(((o,r)=>{if(document&&!(e in c)){var a=document.createElement("script");a.type="text/javascript",a.id="_react_baidu_map",a.src=e,a.async=!0,a.defer=!0,a.onerror=o=>{t.removeChild(a),r(new URIError("The Script "+e+" is no accessible."))},a.onload=()=>{c[e]=!0,o()},t.appendChild(a)}else o()}))}function d(e){return new Promise(((t,o)=>{window&&window.setTimeout(t,e)}))}class u extends o.Component{static ready(){return r((function*(){if(!(window&&window.BMap.Map||window&&window.BMapGL.Map))return new Promise(((e,t)=>{u.waitQueue.push([e,t])}))}))()}constructor(e){if(super(e),this.isMountedOk=!1,this.handleError=e=>{this.isMountedOk&&this.setState({error:e})},this.finish=()=>{window&&"webgl"===this.props.type&&(window.BMap=window.BMapGL),this.isMountedOk&&this.setState({loaded:!0})},this.state={loaded:"webgl"===e.type?window&&!!window.BMapGL&&!!window.BMapGL.Map:window&&!!window.BMap&&!!window.BMap.Map},null==this.props.akay)throw new TypeError("BaiDuMap: akay is required")}componentDidMount(){this.isMountedOk=!0;var{callbackName:e}=this.props;if(window&&e&&("webgl"===this.props.type&&window&&window.BMapGL&&!window.BMapGL.Map||"webgl"===this.props.type&&window&&!window.BMapGL||window&&window.BMap&&!window.BMap.Map||window&&!window.BMap)){if(window&&window[e])return void u.waitQueue.push([this.finish,this.handleError]);this.loadMap()}}componentWillUnmount(){this.isMountedOk=!1}render(){return this.state.loaded?this.props.children:this.props.fallback?this.props.fallback(this.state.error):this.state.error?i("div",{style:{color:"red"},children:this.state.error.message}):null}getScriptSrc(){var e=this.props,t=e.protocol||window.location.protocol;-1===t.indexOf(":")&&(t+=":");var o=["v="+e.version,"ak="+e.akay,"callback="+e.callbackName];return e.type&&o.push("type="+e.type),t+"//"+e.hostAndPath+"?"+o.join("&")}loadMap(){var e=this;return r((function*(){var{callbackName:t}=e.props;if(window&&t){var o=e.getScriptSrc();window[t]=()=>{var t=u.waitQueue;u.waitQueue=[],t.forEach((e=>e[0]())),e.finish()};for(var r=0;r<3;r++)try{yield l(o);break}catch(n){if(2===r){var a=function(){var t=new Error("Failed to load Baidu Map: "+n.message),o=u.waitQueue;return u.waitQueue=[],o.forEach((e=>e[1](t))),e.handleError(t),{v:void 0}}();if("object"==typeof a)return a.v}yield d(1e3*r)}}}))()}}u.defaultProps={akay:"",hostAndPath:"api.map.baidu.com/api",version:"3.0",callbackName:"load_bmap_sdk",type:""},u.waitQueue=[];var f={map:void 0,BMap:void 0,container:void 0},w=(e,t)=>a({},e,t),m=o.createContext({state:f,dispatch:()=>null});function h(e){void 0===e&&(e={});var{widget:o,minZoom:r,maxZoom:a,mapType:n,enableHighResolution:i,enableAutoResize:s,enableMapClick:c}=e,[l,d]=t.exports.useState(),[u,f]=t.exports.useState(e.zoom||15),[w,h]=t.exports.useState(e.container),{dispatch:v}=t.exports.useContext(m);t.exports.useMemo((()=>{if(w&&!l&&BMap){var e=new BMap.Map(w,{minZoom:r,maxZoom:a,mapType:n,enableHighResolution:i,enableAutoResize:s,enableMapClick:c});o&&o.forEach((t=>{if(BMap)if("string"==typeof t)e.addControl(new BMap[t]);else if("object"==typeof t&&t.control&&"function"==typeof t.control)e.addControl(t.control(BMap,e));else if("object"==typeof t&&t.name){var o="function"==typeof t.options?t.options(BMap,e):t.options;e.addControl(new BMap[t.name](o))}})),d(e)}return()=>{l&&l.clearOverlays()}}),[w,l]),t.exports.useEffect((()=>(l&&w&&v({map:l,container:w,BMap:BMap}),()=>{v({map:void 0,container:void 0,BMap:void 0})})),[l,w]);var[M,y]=t.exports.useState(e.center||"上海");t.exports.useEffect((()=>{if(l&&M){var e=M;M&&M.lng&&M.lat&&(e=new BMap.Point(M.lng,M.lat),l.centerAndZoom(e,u)),l.centerAndZoom(M,u)}}),[M,l]);var[C,g]=t.exports.useState(e.autoLocalCity);return t.exports.useEffect((()=>{l&&C&&(new BMap.LocalCity).get((e=>{y(e.name),f(e.level),g(!1)}))}),[C,l]),function(e,o,r,a){void 0===o&&(o={}),void 0===r&&(r=[]),r.forEach((r=>{var n="on"+r,i=o[n];t.exports.useEffect((()=>{if(e&&i&&r){var t=r;return t="CamelCase"===a?r.replace(r[0],r[0].toLowerCase()):r.toLowerCase(),e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}}),[e,o[n]])}))}(l,e,["Click","DblClick","RightClick","RightdblClick","MapTypeChange","MouseMove","MouseOver","MouseOut","MoveStart","Moving","MoveEnd","ZoomStart","ZoomEnd","AddOverlay","AddControl","RemoveControl","RemoveOverlay","ClearOverlays","DragStart","Dragging","DragEnd","AddTileLayer","RemoveTileLayer","Load","ReSize","HotspotClick","HotspotOver","HotspotOut","TilesLoaded","TouchStart","TouchMove","TouchEnd","LongPress"]),p(l,e,["DefaultCursor","DraggingCursor","MinZoom","MaxZoom","MapStyle","MapStyleV2","Panorama","CurrentCity","MapType","Viewport","Zoom"]),function(e,t,o){void 0===t&&(t={}),void 0===o&&(o=[]),o.forEach((o=>{var r="enable"+o,a=t[r]?"enable"+o:"disable"+o;e&&void 0!==t[r]&&e[a]&&e[a]()}))}(l,e,["Dragging","ScrollWheelZoom","DoubleClickZoom","Keyboard","InertialDragging","ContinuousZoom","PinchToZoom","AutoResize"]),{map:l,setMap:d,zoom:u,setZoom:f,container:w,setContainer:h,center:M,setCenter:y,autoLocalCity:C,setAutoLocalCity:g}}var v=["className","style","children"],M=o.forwardRef(((e,r)=>{var{className:p,style:c,children:l}=e,d=n(e,v),[u,M]=t.exports.useReducer(w,f);window.BMap=window.BMap||window.BMapGL;var y=t.exports.useRef(null),{setContainer:C,container:g,setCenter:B,setAutoLocalCity:x,map:b}=h(a({container:y.current},d));t.exports.useEffect((()=>C(y.current)),[y.current]),t.exports.useMemo((()=>d.center&&B(d.center)),[d.center]),t.exports.useEffect((()=>x(d.autoLocalCity)),[d.autoLocalCity]),t.exports.useImperativeHandle(r,(()=>a({},d,{map:b,BMap:BMap,container:y.current})),[b]);var E=o.Children.toArray(l);return t.exports.useEffect((()=>{b&&M({map:b,container:y.current,BMap:BMap})}),[b]),s(m.Provider,{value:{state:u,dispatch:M},children:[i("div",{ref:y,className:p,style:a({fontSize:1,height:"100%"},c)}),BMap&&b&&"function"==typeof l&&l({BMap:BMap,map:b,container:g}),BMap&&b&&E.map(((e,t)=>o.isValidElement(e)?e.type&&"string"==typeof e.type?o.cloneElement(e,{key:t}):o.cloneElement(e,a({},e.props,{BMap:BMap,map:b,container:g,key:t})):null))]})}));function y(e){void 0===e&&(e={});var[o,r]=t.exports.useState(),{anchor:n,offset:i}=e,{map:s}=function(){var{state:e,dispatch:o}=t.exports.useContext(m);return a({},e,{state:e,dispatch:o})}();return t.exports.useEffect((()=>{if(s&&!o){var e=new BMap.CopyrightControl({anchor:n||BMAP_ANCHOR_TOP_RIGHT,offset:i});s.addControl(e),r(e)}return()=>{s&&o&&s.removeControl(o)}}),[s,o,n,i]),function(e,o){void 0===o&&(o={});var r=o.visiable,[a,n]=t.exports.useState(r);t.exports.useEffect((()=>{e&&void 0!==r&&(r?e.show&&e.show():e.hide&&e.hide(),r!==a&&n(r))}),[e,a,r])}(o,e),p(o,e,["Anchor","Offset"]),{copyrightControl:o,setCopyrightControl:r}}var C=1;o.forwardRef(((e,r)=>{var{copyrightControl:n}=y(e);return t.exports.useImperativeHandle(r,(()=>a({},e,{copyrightControl:n})),[n]),i(t.exports.Fragment,{children:o.Children.toArray(e.children).map(((e,t)=>o.isValidElement(e)?o.cloneElement(e,{control:n,id:t+1}):e))})})).Item=function(o){void 0===o&&(o={});var r,a,{children:n,control:s,bounds:p}=o,[c]=t.exports.useState(C++),{container:l}=function(o){var r=t.exports.useRef(document.createElement("div"));return t.exports.useLayoutEffect((()=>{e.exports.render(i(t.exports.Fragment,{children:o.children}),r.current)}),[o.children]),{container:r.current}}({children:n}),d=(r=c,a=t.exports.useRef(),t.exports.useEffect((()=>{a.current=r})),a.current);return t.exports.useEffect((()=>(s&&s.addCopyright({id:c,bounds:p,content:l.innerHTML}),function(){d&&s&&s.removeCopyright(d)})),[n,s]),null};export{u as A,M};
