import{r as e}from"../react-dom/react-dom.7870d50f.js";import{r as t,j as o,R as r}from"../react/react.e5edc743.js";import{e as a,_ as n,d as i}from"../@babel/@babel.7c7b387f.js";function s(e,o,r){void 0===r&&(r=[]),r.forEach((r=>{var a=""+r.charAt(0).toLowerCase()+r.slice(1),[n,i]=t.exports.useState(o[a]);t.exports.useEffect((()=>{if(e&&e["set"+r]&&void 0!==o[a]){var t=o[a];if(t&&t.lng&&t.lat){t=new BMap.Point(t.lng,t.lat);var s=n;if(s&&s.lng&&s.lat&&(s=new BMap.Point(s.lng,s.lat),t.equals(s)))return}e["set"+r](t),n!==o[a]&&("bounds"===a?n&&o[a]&&!n.equals(o[a])&&i(o[a]):i(o[a]))}}),[e,o[a]])}))}var p={};function c(e){var t=document&&(document.head||document.getElementsByTagName("head")[0]);return new Promise(((o,r)=>{if(document&&!(e in p)){var a=document.createElement("script");a.type="text/javascript",a.id="_react_baidu_map",a.src=e,a.async=!0,a.defer=!0,a.onerror=o=>{t.removeChild(a),r(new URIError("The Script "+e+" is no accessible."))},a.onload=()=>{p[e]=!0,o()},t.appendChild(a)}else o()}))}function l(e){return new Promise(((t,o)=>{window&&window.setTimeout(t,e)}))}class d extends r.Component{static ready(){return a((function*(){if(!(window&&window.BMap.Map||window&&window.BMapGL.Map))return new Promise(((e,t)=>{d.waitQueue.push([e,t])}))}))()}constructor(e){if(super(e),this.isMountedOk=!1,this.handleError=e=>{this.isMountedOk&&this.setState({error:e})},this.finish=()=>{window&&"webgl"===this.props.type&&(window.BMap=window.BMapGL),this.isMountedOk&&this.setState({loaded:!0})},this.state={loaded:"webgl"===e.type?window&&!!window.BMapGL&&!!window.BMapGL.Map:window&&!!window.BMap&&!!window.BMap.Map},null==this.props.akay)throw new TypeError("BaiDuMap: akay is required")}componentDidMount(){this.isMountedOk=!0;var{callbackName:e}=this.props;if(window&&e&&("webgl"===this.props.type&&window&&window.BMapGL&&!window.BMapGL.Map||"webgl"===this.props.type&&window&&!window.BMapGL||window&&window.BMap&&!window.BMap.Map||window&&!window.BMap)){if(window&&window[e])return void d.waitQueue.push([this.finish,this.handleError]);this.loadMap()}}componentWillUnmount(){this.isMountedOk=!1}render(){return this.state.loaded?this.props.children:this.props.fallback?this.props.fallback(this.state.error):this.state.error?o.exports.jsx("div",{style:{color:"red"},children:this.state.error.message}):null}getScriptSrc(){var e=this.props,t=e.protocol||window.location.protocol;-1===t.indexOf(":")&&(t+=":");var o=["v="+e.version,"ak="+e.akay,"callback="+e.callbackName];return e.type&&o.push("type="+e.type),t+"//"+e.hostAndPath+"?"+o.join("&")}loadMap(){var e=this;return a((function*(){var{callbackName:t}=e.props;if(window&&t){var o=e.getScriptSrc();window[t]=()=>{var t=d.waitQueue;d.waitQueue=[],t.forEach((e=>e[0]())),e.finish()};for(var r=0;r<3;r++)try{yield c(o);break}catch(n){if(2===r){var a=function(){var t=new Error("Failed to load Baidu Map: "+n.message),o=d.waitQueue;return d.waitQueue=[],o.forEach((e=>e[1](t))),e.handleError(t),{v:void 0}}();if("object"==typeof a)return a.v}yield l(1e3*r)}}}))()}}d.defaultProps={akay:"",hostAndPath:"api.map.baidu.com/api",version:"3.0",callbackName:"load_bmap_sdk",type:""},d.waitQueue=[];var u={map:void 0,BMap:void 0,container:void 0},f=(e,t)=>n({},e,t),w=r.createContext({state:u,dispatch:()=>null});function h(e){void 0===e&&(e={});var{widget:o,minZoom:r,maxZoom:a,mapType:n,enableHighResolution:i,enableAutoResize:p,enableMapClick:c}=e,[l,d]=t.exports.useState(),[u,f]=t.exports.useState(e.zoom||15),[h,m]=t.exports.useState(e.container),{dispatch:v}=t.exports.useContext(w);t.exports.useMemo((()=>{if(h&&!l&&BMap){var e=new BMap.Map(h,{minZoom:r,maxZoom:a,mapType:n,enableHighResolution:i,enableAutoResize:p,enableMapClick:c});o&&o.forEach((t=>{if(BMap)if("string"==typeof t)e.addControl(new BMap[t]);else if("object"==typeof t&&t.control&&"function"==typeof t.control)e.addControl(t.control(BMap,e));else if("object"==typeof t&&t.name){var o="function"==typeof t.options?t.options(BMap,e):t.options;e.addControl(new BMap[t.name](o))}})),d(e)}return()=>{l&&l.clearOverlays()}}),[h,l]),t.exports.useEffect((()=>(l&&h&&v({map:l,container:h,BMap:BMap}),()=>{v({map:void 0,container:void 0,BMap:void 0})})),[l,h]);var[M,y]=t.exports.useState(e.center||"上海");t.exports.useEffect((()=>{if(l&&M){var e=M;M&&M.lng&&M.lat&&(e=new BMap.Point(M.lng,M.lat),l.centerAndZoom(e,u)),l.centerAndZoom(M,u)}}),[M,l]);var[C,x]=t.exports.useState(e.autoLocalCity);return t.exports.useEffect((()=>{l&&C&&(new BMap.LocalCity).get((e=>{y(e.name),f(e.level),x(!1)}))}),[C,l]),function(e,o,r,a){void 0===o&&(o={}),void 0===r&&(r=[]),r.forEach((r=>{var n="on"+r,i=o[n];t.exports.useEffect((()=>{if(e&&i&&r){var t=r;return t="CamelCase"===a?r.replace(r[0],r[0].toLowerCase()):r.toLowerCase(),e.addEventListener(t,i),()=>{e.removeEventListener(t,i)}}}),[e,o[n]])}))}(l,e,["Click","DblClick","RightClick","RightdblClick","MapTypeChange","MouseMove","MouseOver","MouseOut","MoveStart","Moving","MoveEnd","ZoomStart","ZoomEnd","AddOverlay","AddControl","RemoveControl","RemoveOverlay","ClearOverlays","DragStart","Dragging","DragEnd","AddTileLayer","RemoveTileLayer","Load","ReSize","HotspotClick","HotspotOver","HotspotOut","TilesLoaded","TouchStart","TouchMove","TouchEnd","LongPress"]),s(l,e,["DefaultCursor","DraggingCursor","MinZoom","MaxZoom","MapStyle","MapStyleV2","Panorama","CurrentCity","MapType","Viewport","Zoom"]),function(e,t,o){void 0===t&&(t={}),void 0===o&&(o=[]),o.forEach((o=>{var r="enable"+o,a=t[r]?"enable"+o:"disable"+o;e&&void 0!==t[r]&&e[a]&&e[a]()}))}(l,e,["Dragging","ScrollWheelZoom","DoubleClickZoom","Keyboard","InertialDragging","ContinuousZoom","PinchToZoom","AutoResize"]),{map:l,setMap:d,zoom:u,setZoom:f,container:h,setContainer:m,center:M,setCenter:y,autoLocalCity:C,setAutoLocalCity:x}}var m=["className","style","children"],v=r.forwardRef(((e,a)=>{var{className:s,style:p,children:c}=e,l=i(e,m),[d,v]=t.exports.useReducer(f,u);window.BMap=window.BMap||window.BMapGL;var M=t.exports.useRef(null),{setContainer:y,container:C,setCenter:x,setAutoLocalCity:g,map:B}=h(n({container:M.current},l));t.exports.useEffect((()=>y(M.current)),[M.current]),t.exports.useMemo((()=>l.center&&x(l.center)),[l.center]),t.exports.useEffect((()=>g(l.autoLocalCity)),[l.autoLocalCity]),t.exports.useImperativeHandle(a,(()=>n({},l,{map:B,BMap:BMap,container:M.current})),[B]);var b=r.Children.toArray(c);return t.exports.useEffect((()=>{B&&v({map:B,container:M.current,BMap:BMap})}),[B]),o.exports.jsxs(w.Provider,{value:{state:d,dispatch:v},children:[o.exports.jsx("div",{ref:M,className:s,style:n({fontSize:1,height:"100%"},p)}),BMap&&B&&"function"==typeof c&&c({BMap:BMap,map:B,container:C}),BMap&&B&&b.map(((e,t)=>r.isValidElement(e)?e.type&&"string"==typeof e.type?r.cloneElement(e,{key:t}):r.cloneElement(e,n({},e.props,{BMap:BMap,map:B,container:C,key:t})):null))]})}));function M(e){void 0===e&&(e={});var[o,r]=t.exports.useState(),{anchor:a,offset:i}=e,{map:p}=function(){var{state:e,dispatch:o}=t.exports.useContext(w);return n({},e,{state:e,dispatch:o})}();return t.exports.useEffect((()=>{if(p&&!o){var e=new BMap.CopyrightControl({anchor:a||BMAP_ANCHOR_TOP_RIGHT,offset:i});p.addControl(e),r(e)}return()=>{p&&o&&p.removeControl(o)}}),[p,o,a,i]),function(e,o){void 0===o&&(o={});var r=o.visiable,[a,n]=t.exports.useState(r);t.exports.useEffect((()=>{e&&void 0!==r&&(r?e.show&&e.show():e.hide&&e.hide(),r!==a&&n(r))}),[e,a,r])}(o,e),s(o,e,["Anchor","Offset"]),{copyrightControl:o,setCopyrightControl:r}}var y=1;r.forwardRef(((e,a)=>{var{copyrightControl:i}=M(e);return t.exports.useImperativeHandle(a,(()=>n({},e,{copyrightControl:i})),[i]),o.exports.jsx(t.exports.Fragment,{children:r.Children.toArray(e.children).map(((e,t)=>r.isValidElement(e)?r.cloneElement(e,{control:i,id:t+1}):e))})})).Item=function(r){void 0===r&&(r={});var a,n,{children:i,control:s,bounds:p}=r,[c]=t.exports.useState(y++),{container:l}=function(r){var a=t.exports.useRef(document.createElement("div"));return t.exports.useLayoutEffect((()=>{e.exports.render(o.exports.jsx(t.exports.Fragment,{children:r.children}),a.current)}),[r.children]),{container:a.current}}({children:i}),d=(a=c,n=t.exports.useRef(),t.exports.useEffect((()=>{n.current=a})),n.current);return t.exports.useEffect((()=>(s&&s.addCopyright({id:c,bounds:p,content:l.innerHTML}),function(){d&&s&&s.removeCopyright(d)})),[i,s]),null};export{d as A,v as M};
