var n="data-focus-lock",e="data-focus-lock-disabled",t=function(n){for(var e=Array(n.length),t=0;t<n.length;++t)e[t]=n[t];return e},r=function(n){return Array.isArray(n)?n:[n]},o=function(n){return n.parentNode?o(n.parentNode):n},u=function(n){return r(n).filter(Boolean).reduce((function(n,e){var r=e.getAttribute("data-focus-lock");return n.push.apply(n,r?function(n){for(var e=new Set,t=n.length,r=0;r<t;r+=1)for(var o=r+1;o<t;o+=1){var u=n[r].compareDocumentPosition(n[o]);(u&Node.DOCUMENT_POSITION_CONTAINED_BY)>0&&e.add(o),(u&Node.DOCUMENT_POSITION_CONTAINS)>0&&e.add(r)}return n.filter((function(n,t){return!e.has(t)}))}(t(o(e).querySelectorAll("[".concat("data-focus-lock",'="').concat(r,'"]:not([').concat("data-focus-lock-disabled",'="disabled"])')))):[e]),n}),[])},a=function(){return document.activeElement?document.activeElement.shadowRoot?document.activeElement.shadowRoot.activeElement:document.activeElement:void 0},i=function(n){return Boolean(t(n.querySelectorAll("iframe")).some((function(n){return n===document.activeElement})))},c=function(n){var e=document&&a();return!(!e||e.dataset&&e.dataset.focusGuard)&&u(n).reduce((function(n,t){return n||t.contains(e)||i(t)}),!1)},f=function(){var n=document&&a();return!!n&&t(document.querySelectorAll("[".concat("data-no-focus-lock","]"))).some((function(e){return e.contains(n)}))},d=function(n,e){return!n||n===document||n&&n.nodeType===Node.DOCUMENT_NODE||!function(n){if(n.nodeType!==Node.ELEMENT_NODE)return!1;var e=window.getComputedStyle(n,null);return!(!e||!e.getPropertyValue||"none"!==e.getPropertyValue("display")&&"hidden"!==e.getPropertyValue("visibility"))}(n)&&e(n.parentNode&&n.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE?n.parentNode.host:n.parentNode)},l=function(n,e){var t=n.get(e);if(void 0!==t)return t;var r=d(e,l.bind(void 0,n));return n.set(e,r),r},s=function(n){return n.dataset},v=function(n){return"INPUT"===n.tagName},m=function(n){return v(n)&&"radio"===n.type},p=function(n){var e;return Boolean(n&&(null===(e=s(n))||void 0===e?void 0:e.focusGuard))},N=function(n){return!p(n)},b=function(n){return Boolean(n)},O=function(n,e){return m(n)&&n.name?function(n,e){return e.filter(m).filter((function(e){return e.name===n.name})).filter((function(n){return n.checked}))[0]||n}(n,e):n},h=function(n){return n[0]&&n.length>1?O(n[0],n):n[0]},x=function(n,e){return n.length>1?n.indexOf(O(n[e],n)):e},E=function(n,e,t,r){var o=n.length,u=n[0],a=n[o-1],i=p(t);if(!(t&&n.indexOf(t)>=0)){var c,f,d=void 0!==t?e.indexOf(t):-1,l=r?e.indexOf(r):d,s=r?n.indexOf(r):-1,v=d-l,m=e.indexOf(u),N=e.indexOf(a),b=(c=e,f=new Set,c.forEach((function(n){return f.add(O(n,c))})),c.filter((function(n){return f.has(n)}))),h=(void 0!==t?b.indexOf(t):-1)-(r?b.indexOf(r):d),E=x(n,0),y=x(n,o-1);return-1===d||-1===s?"NEW_FOCUS":!v&&s>=0?s:d<=m&&i&&Math.abs(v)>1?y:d>=N&&i&&Math.abs(v)>1?E:v&&Math.abs(h)>1?s:d<=m?y:d>N?E:v?Math.abs(v)>1?s:(o+s+v)%o:void 0}},y=function(n,e){var t=n.tabIndex-e.tabIndex,r=n.index-e.index;if(t){if(!n.tabIndex)return 1;if(!e.tabIndex)return-1}return t||r},g=function(n,e,r){return t(n).map((function(n,e){return{node:n,index:e,tabIndex:r&&-1===n.tabIndex?(n.dataset||{}).focusGuard?0:-1:n.tabIndex}})).filter((function(n){return!e||n.tabIndex>=0})).sort(y)},T=["button:enabled","select:enabled","textarea:enabled","input:enabled","a[href]","area[href]","summary","iframe","object","embed","audio[controls]","video[controls]","[tabindex]","[contenteditable]","[autofocus]"].join(","),I="".concat(T,", [data-focus-guard]"),S=function(n,e){return n.reduce((function(n,r){return n.concat(t(r.querySelectorAll(e?I:T)),r.parentNode?t(r.parentNode.querySelectorAll(T)).filter((function(n){return n===r})):[])}),[])},A=function(n,e){return t(n).filter((function(n){return l(e,n)})).filter((function(n){return function(n){return!((v(n)||function(n){return"BUTTON"===n.tagName}(n))&&("hidden"===n.type||n.disabled)||n.ariaDisabled)}(n)}))},M=function(n,e,t){return g(A(S(n,t),e),!0,t)},w=function(n,e){return g(A(S(n),e),!1)},_=function(n,e){return A((r=n.querySelectorAll("[".concat("data-autofocus-inside","]")),t(r).map((function(n){return S([n])})).reduce((function(n,e){return n.concat(e)}),[])),e);var r},D=function(n,e){return void 0===e&&(e=[]),e.push(n),n.parentNode&&D(n.parentNode,e),e},C=function(n,e){for(var t=D(n),r=D(e),o=0;o<t.length;o+=1){var u=t[o];if(r.indexOf(u)>=0)return u}return!1},k=function(n,e,t){var o=r(n),u=r(e),a=o[0],i=!1;return u.filter(Boolean).forEach((function(n){i=C(i||n,n)||i,t.filter(Boolean).forEach((function(n){var e=C(a,n);e&&(i=!i||e.contains(i)?e:C(e,i))}))})),i},B=function(n,e){var t=document&&a(),r=u(n).filter(N),o=k(t||n,n,r),i=new Map,c=w(r,i),f=M(r,i).filter((function(n){var e=n.node;return N(e)}));if(f[0]||(f=c)[0]){var d,l,v,m,p=w([o],i).map((function(n){return n.node})),O=(d=p,l=f,v=new Map,l.forEach((function(n){return v.set(n.node,n)})),d.map((function(n){return v.get(n)})).filter(b)),x=O.map((function(n){return n.node})),y=E(x,p,t,e);if("NEW_FOCUS"===y){var g=c.map((function(n){return n.node})).filter((m=function(n,e){return n.reduce((function(n,t){return n.concat(_(t,e))}),[])}(r,i),function(n){var e;return n.autofocus||!!(null===(e=s(n))||void 0===e?void 0:e.autofocus)||m.indexOf(n)>=0}));return{node:g&&g.length?h(g):h(x)}}return void 0===y?y:O[y]}},U=function(n){var e=u(n).filter(N),t=k(n,n,e),r=new Map,o=M([t],r,!0),a=M(e,r).filter((function(n){var e=n.node;return N(e)})).map((function(n){return n.node}));return o.map((function(n){var e=n.node;return{node:e,index:n.index,lockItem:a.indexOf(e)>=0,guard:p(e)}}))},P=0,q=!1,W=function(n,e,t){void 0===t&&(t={});var r,o,u=B(n,e);if(!q&&u){if(P>2)return q=!0,void setTimeout((function(){q=!1}),1);P++,r=u.node,o=t.focusOptions,"focus"in r&&r.focus(o),"contentWindow"in r&&r.contentWindow&&r.contentWindow.focus(),P--}};export{e as F,n as a,f as b,c as f,U as g,W as m};
